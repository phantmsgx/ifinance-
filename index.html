<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iFinance Premium</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* TRAVA ADICIONAL PARA TOQUE E ZOOM */
        html, body { 
            touch-action: pan-x pan-y; 
            overscroll-behavior: none;
        }
        body { font-family: 'Inter', sans-serif; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none !important; }
        .tab-active { color: #2563eb; transform: scale(1.1); }
        * { user-select: none; -webkit-touch-callout: none; }
        input, select, textarea { user-select: auto; font-size: 16px !important; } /* Font-size 16px evita zoom automÃ¡tico no iOS */
        .bg-auth { background: radial-gradient(circle at top right, #eff6ff, #ffffff); }
        ::-webkit-scrollbar { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <section id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-auth text-center">
        <div class="mb-6 w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center shadow-xl text-white text-4xl">
            <i class="fa-solid fa-wallet"></i>
        </div>
        <h1 id="auth-title" class="text-4xl font-black mb-2">i<span class="text-blue-600">Finance</span></h1>
        
        <div class="flex flex-col w-full max-w-sm gap-4">
            <input type="email" id="emailInput" placeholder="E-mail" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
            <input type="password" id="passInput" placeholder="Senha" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
            
            <div id="register-fields" class="hidden flex flex-col gap-4">
                <input type="text" id="userNameInput" placeholder="Como quer ser chamado?" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
                
                <select id="userCurrencyInput" onchange="updateSalaryMask()" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
                    <option value="BRL">ðŸ‡§ðŸ‡· BRL - Real</option>
                    <option value="USD">ðŸ‡ºðŸ‡¸ USD - DÃ³lar</option>
                    <option value="EUR">ðŸ‡ªðŸ‡º EUR - Euro</option>
                    <option value="GBP">ðŸ‡¬ðŸ‡§ GBP - Libra</option>
                    <option value="JPY">ðŸ‡¯ðŸ‡µ JPY - Iene</option>
                    <option value="MXN">ðŸ‡²ðŸ‡½ MXN - Peso Mexicano</option>
                    <option value="CHF">ðŸ‡¨ðŸ‡­ CHF - Franco SuÃ­Ã§o</option>
                    <option value="BTC">â‚¿ BTC - Bitcoin</option>
                </select>

                <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100 text-left">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-2">ConfiguraÃ§Ã£o de Renda</p>
                    <input type="text" id="salaryInput" placeholder="0,00" class="w-full bg-transparent border-b border-blue-200 py-2 font-bold text-xl outline-none">
                </div>
            </div>

            <button onclick="handleAuth()" id="btn-main-auth" class="bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition">Entrar</button>
            <button onclick="toggleAuthMode()" id="btn-switch-auth" class="text-blue-600 font-bold mt-2">Criar conta gratuita</button>
        </div>
    </section>

    <div id="main-app" class="hidden">
        <section id="tab-home">
            <header class="bg-white border-b p-4 sticky top-0 z-10 flex justify-between items-center px-8">
                <h1 class="text-xl font-extrabold text-blue-600 italic">iFinance</h1>
                <button onclick="logout()"><i class="fa-solid fa-right-from-bracket text-slate-300"></i></button>
            </header>
            
            <main class="p-6 max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-center">
                    <div class="bg-white p-6 rounded-2xl border-2 border-blue-50 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Saldo DisponÃ­vel</p>
                        <h2 class="text-3xl font-black" id="balance">0,00</h2>
                        <span class="text-[9px] font-black text-blue-600 bg-blue-100 px-2 py-1 rounded-full uppercase">Renda: <span id="displaySalary">0,00</span></span>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-green-500 uppercase">Entradas</p>
                        <h2 class="text-2xl font-black text-green-600" id="incomes">0,00</h2>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-red-500 uppercase">SaÃ­das</p>
                        <h2 class="text-2xl font-black text-red-600" id="expenses">0,00</h2>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl border mb-10 grid grid-cols-1 md:grid-cols-4 gap-4 shadow-sm">
                    <input type="text" id="desc" placeholder="DescriÃ§Ã£o" class="bg-slate-50 p-4 rounded-2xl border-none outline-blue-500">
                    <input type="text" id="amountDisplay" placeholder="0,00" class="bg-slate-50 p-4 rounded-2xl border-none font-bold text-lg text-center outline-blue-500">
                    <select id="type" class="bg-slate-50 p-4 rounded-2xl border-none font-bold">
                        <option value="expense">SaÃ­da (-)</option>
                        <option value="income">Entrada (+)</option>
                    </select>
                    <button onclick="addTransaction()" class="bg-blue-600 text-white font-bold rounded-2xl py-4 shadow-lg">Salvar</button>
                </div>

                <div class="bg-white p-6 rounded-3xl border shadow-sm">
                    <ul id="transaction-list" class="divide-y divide-slate-50"></ul>
                    <button onclick="limparTudo()" class="w-full text-center py-4 text-[10px] text-red-300 font-bold uppercase mt-4">Zerar Tudo</button>
                </div>
            </main>
        </section>

        <section id="tab-cambio" class="hidden p-6">
             <div class="max-w-md mx-auto bg-white p-8 rounded-[40px] border shadow-sm space-y-6">
                <div class="flex items-center justify-between gap-4">
                    <select id="fromCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none">
                        <option value="USD">ðŸ‡ºðŸ‡¸ USD</option><option value="EUR">ðŸ‡ªðŸ‡º EUR</option><option value="BRL">ðŸ‡§ðŸ‡· BRL</option><option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                    </select>
                    <i class="fa-solid fa-repeat text-blue-500"></i>
                    <select id="toCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none">
                        <option value="BRL">ðŸ‡§ðŸ‡· BRL</option><option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                    </select>
                </div>
                <input type="text" id="calcValueDisplay" placeholder="0,00" class="w-full bg-slate-50 p-6 rounded-2xl font-bold text-3xl text-center outline-none">
                <div class="text-center"><span id="infoCotacao" class="text-blue-500 font-bold bg-blue-50 px-4 py-2 rounded-full text-[10px]">Carregando...</span></div>
                <div class="bg-blue-600 p-8 rounded-[32px] text-center shadow-xl">
                    <h3 class="text-4xl font-black text-white" id="calcResultDisplay">0,00</h3>
                </div>
                <button onclick="lancarCambio()" class="w-full bg-slate-900 text-white font-black p-5 rounded-2xl text-xs uppercase">LanÃ§ar no Saldo</button>
             </div>
        </section>

        <section id="tab-viagem" class="hidden p-6 text-center">
            <h2 class="text-2xl font-black mb-6">Guia de Restaurantes</h2>
            <div class="flex gap-2 overflow-x-auto pb-4 mb-4 no-scrollbar">
                <button onclick="setGuide('BRL')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡§ðŸ‡· Brasil</button>
                <button onclick="setGuide('USD')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡ºðŸ‡¸ EUA</button>
                <button onclick="setGuide('EUR')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡ªðŸ‡º Europa</button>
                <button onclick="setGuide('ITA')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡®ðŸ‡¹ ItÃ¡lia</button>
                <button onclick="setGuide('JPN')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡¯ðŸ‡µ JapÃ£o</button>
                <button onclick="setGuide('MEX')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡²ðŸ‡½ MÃ©xico</button>
                <button onclick="setGuide('PRT')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0">ðŸ‡µðŸ‡¹ Portugal</button>
            </div>
            <div id="restaurant-list" class="space-y-4 pb-24"></div>
        </section>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t py-4 flex justify-around shadow-2xl z-50">
            <button onclick="switchTab('home')" id="nav-home" class="flex flex-col items-center tab-active">
                <i class="fa-solid fa-wallet text-xl"></i><span class="text-[9px] font-black mt-1">CARTEIRA</span>
            </button>
            <button onclick="switchTab('cambio')" id="nav-cambio" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-money-bill-transfer text-xl"></i><span class="text-[9px] font-black mt-1">CÃ‚MBIO</span>
            </button>
            <button onclick="switchTab('viagem')" id="nav-viagem" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-utensils text-xl"></i><span class="text-[9px] font-black mt-1">GUIA</span>
            </button>
        </nav>
    </div>

    <script>
        // ... (Mesma lÃ³gica de JavaScript do cÃ³digo anterior, mantendo restaurantes e funÃ§Ãµes)
        const restaurantesDB = {
            'BRL': [{nome:'A Casa do Porco', cidade:'SP', tipo:'Brasileira', preco:'$$$', icone:'ðŸ·'}, {nome:'Marius Degustare', cidade:'RJ', tipo:'Churrasco', preco:'$$$$', icone:'ðŸ¥©'}, {nome:'D.O.M', cidade:'SP', tipo:'Fina', preco:'$$$$$', icone:'ðŸŒ¿'}, {nome:'ManÃ­', cidade:'SP', tipo:'Moderna', preco:'$$$$', icone:'ðŸ¥£'}, {nome:'Glouton', cidade:'BH', tipo:'Mineira', preco:'$$$', icone:'ðŸ·'}],
            'USD': [{nome:'Joe\'s Pizza', cidade:'NY', tipo:'Pizza', preco:'$', icone:'ðŸ•'}, {nome:'Katz\'s Deli', cidade:'NY', tipo:'SanduÃ­che', preco:'$$', icone:'ðŸ¥ª'}, {nome:'Le Bernardin', cidade:'NY', tipo:'Peixe', preco:'$$$$$', icone:'ðŸŸ'}, {nome:'Nobu Malibu', cidade:'LA', tipo:'JaponÃªs', preco:'$$$$', icone:'ðŸ£'}, {nome:'French Laundry', cidade:'Napa', tipo:'FrancÃªs', preco:'$$$$$', icone:'ðŸ°'}],
            'EUR': [{nome:'Le Meurice', cidade:'Paris', tipo:'Luxo', preco:'$$$$$', icone:'ðŸ¥'}, {nome:'Ciel de Paris', cidade:'Paris', tipo:'Vista', preco:'$$$$', icone:'ðŸ—¼'}, {nome:'HofbrÃ¤uhaus', cidade:'Munique', tipo:'AlemÃ£', preco:'$$', icone:'ðŸº'}, {nome:'Septime', cidade:'Paris', tipo:'Moderno', preco:'$$$$', icone:'ðŸ·'}, {nome:'Steirereck', cidade:'Viena', tipo:'Criativa', preco:'$$$$$', icone:'ðŸ‡¦ðŸ‡¹'}],
            'ITA': [{nome:'Osteria Francescana', cidade:'Modena', tipo:'Criativa', preco:'$$$$$', icone:'ðŸŽ¨'}, {nome:'Trattoria Baffetto', cidade:'Roma', tipo:'Pizza', preco:'$$', icone:'ðŸ‡®ðŸ‡¹'}, {nome:'La Pergola', cidade:'Roma', tipo:'Gourmet', preco:'$$$$$', icone:'ðŸ›ï¸'}, {nome:'Da Vittorio', cidade:'BÃ©rgamo', tipo:'Peixes', preco:'$$$$', icone:'ðŸ'}, {nome:'Antica Pesa', cidade:'Roma', tipo:'Tradicional', preco:'$$$', icone:'ðŸ·'}],
            'JPN': [{nome:'Sukiyabashi Jiro', cidade:'TÃ³quio', tipo:'Sushi', preco:'$$$$$', icone:'ðŸ£'}, {nome:'Ichiran Ramen', cidade:'TÃ³quio', tipo:'Ramen', preco:'$', icone:'ðŸœ'}, {nome:'Narisawa', cidade:'TÃ³quio', tipo:'Inovador', preco:'$$$$$', icone:'ðŸŒ²'}, {nome:'Kobe Beef Kaiseki', cidade:'Kobe', tipo:'Wagyu', preco:'$$$$', icone:'ðŸ‚'}, {nome:'Gion Nanba', cidade:'Quioto', tipo:'Kaiseki', preco:'$$$$', icone:'ðŸµ'}],
            'MEX': [{nome:'Pujol', cidade:'CDMX', tipo:'Mexicana', preco:'$$$$$', icone:'ðŸŒ®'}, {nome:'Quintonil', cidade:'CDMX', tipo:'Moderna', preco:'$$$$$', icone:'ðŸ¥‘'}, {nome:'El Farolito', cidade:'CDMX', tipo:'Tacos', preco:'$', icone:'ðŸŒ®'}, {nome:'Rosetta', cidade:'CDMX', tipo:'Italiano-Mex', preco:'$$$', icone:'ðŸ'}, {nome:'Contramar', cidade:'CDMX', tipo:'Frutos do Mar', preco:'$$$', icone:'ðŸŸ'}],
            'PRT': [{nome:'Belcanto', cidade:'Lisboa', tipo:'Portuguesa', preco:'$$$$$', icone:'ðŸ‡µðŸ‡¹'}, {nome:'Solar dos Presuntos', cidade:'Lisboa', tipo:'Tradicional', preco:'$$$', icone:'ðŸ·'}, {nome:'Ramiro', cidade:'Lisboa', tipo:'Marisqueira', preco:'$$$$', icone:'ðŸ¦ž'}, {nome:'The Yeatman', cidade:'Porto', tipo:'Gourmet', preco:'$$$$$', icone:'ðŸ·'}, {nome:'PastÃ©is de BelÃ©m', cidade:'Lisboa', tipo:'Doces', preco:'$', icone:'ðŸ§'}]
        };

        let isRegisterMode = false, currentUser = null, currentRate = 1;
        let rawValues = { amountDisplay: 0, salaryInput: 0, calcValueDisplay: 0 };

        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('register-fields').classList.toggle('hidden');
            document.getElementById('btn-main-auth').innerText = isRegisterMode ? 'ComeÃ§ar Agora' : 'Entrar';
            if(isRegisterMode) updateSalaryMask();
        }

        function updateSalaryMask() {
            const cur = document.getElementById('userCurrencyInput').value;
            document.getElementById('salaryInput').value = format(rawValues.salaryInput, cur);
        }

        function handleAuth() {
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            if (isRegisterMode) {
                const name = document.getElementById('userNameInput').value.trim();
                const currency = document.getElementById('userCurrencyInput').value;
                const userData = { name, pass, currency, salary: rawValues.salaryInput, lastMonth: "", transactions: [] };
                localStorage.setItem(`user_${email}`, JSON.stringify(userData));
                alert("Conta criada!"); toggleAuthMode();
            } else {
                const saved = localStorage.getItem(`user_${email}`);
                if (saved) {
                    const user = JSON.parse(saved);
                    if (user.pass === pass) {
                        currentUser = { ...user, email };
                        verificarSalario();
                        startApp();
                    } else { alert("Senha incorreta."); }
                } else { alert("NÃ£o encontrado."); }
            }
        }

        function verificarSalario() {
            const agora = new Date();
            const mesRef = `${agora.getMonth() + 1}/${agora.getFullYear()}`;
            if (currentUser.salary > 0 && currentUser.lastMonth !== mesRef) {
                currentUser.transactions.push({ id: Date.now(), text: "SalÃ¡rio Mensal ðŸ’°", amount: currentUser.salary, date: agora.toLocaleDateString() });
                currentUser.lastMonth = mesRef;
                save();
            }
        }

        function startApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('displaySalary').innerText = format(currentUser.salary);
            document.getElementById('toCurrency').value = currentUser.currency;
            render(); setGuide('BRL'); buscarCotacao();
        }

        function format(val, curr) {
            const c = curr || (currentUser ? currentUser.currency : 'BRL');
            const loc = {'BRL':'pt-BR','USD':'en-US','EUR':'de-DE','GBP':'en-GB','JPY':'ja-JP','BTC':'en-US','MXN':'es-MX'};
            return val.toLocaleString(loc[c] || 'pt-BR', { style:'currency', currency: c, minimumFractionDigits: (c === 'BTC' ? 8 : 2) });
        }

        function applyMask(id) {
            document.getElementById(id).addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, '');
                let num = v ? parseFloat(v) / 100 : 0;
                rawValues[id] = num;
                let c = id === 'salaryInput' ? document.getElementById('userCurrencyInput').value : (id === 'calcValueDisplay' ? document.getElementById('fromCurrency').value : null);
                e.target.value = format(num, c);
                if (id === 'calcValueDisplay') atualizarResultado();
            });
            document.getElementById(id).value = format(0, id === 'salaryInput' ? 'BRL' : null);
        }

        ['amountDisplay', 'salaryInput', 'calcValueDisplay'].forEach(applyMask);

        function addTransaction() {
            const desc = document.getElementById('desc').value;
            const amtRaw = rawValues.amountDisplay;
            if(!desc || amtRaw === 0) return;
            const amt = document.getElementById('type').value === 'expense' ? -amtRaw : amtRaw;
            currentUser.transactions.push({ id: Date.now(), text: desc, amount: amt, date: new Date().toLocaleDateString() });
            save(); render();
            document.getElementById('desc').value = '';
            rawValues.amountDisplay = 0;
            document.getElementById('amountDisplay').value = format(0);
        }

        function render() {
            const amts = currentUser.transactions.map(t => t.amount);
            const total = amts.reduce((a, b) => a + b, 0);
            document.getElementById('balance').innerText = format(total);
            document.getElementById('incomes').innerText = format(amts.filter(v => v > 0).reduce((a, b) => a + b, 0));
            document.getElementById('expenses').innerText = format(Math.abs(amts.filter(v => v < 0).reduce((a, b) => a + b, 0)));
            const list = document.getElementById('transaction-list');
            list.innerHTML = [...currentUser.transactions].reverse().map(t => `
                <li class="flex justify-between items-center py-4">
                    <div><p class="font-bold text-sm">${t.text}</p><p class="text-[9px] text-slate-400 font-bold">${t.date}</p></div>
                    <span class="${t.amount < 0 ? 'text-red-500':'text-emerald-600'} font-black">${format(t.amount)}</span>
                </li>
            `).join('');
        }

        async function buscarCotacao() {
            const f = document.getElementById('fromCurrency').value, t = document.getElementById('toCurrency').value;
            if(f === t) { currentRate = 1; document.getElementById('infoCotacao').innerText = "1:1"; atualizarResultado(); return; }
            try {
                const r = await fetch(`https://economia.awesomeapi.com.br/last/${f}-${t}`);
                const d = await r.json();
                currentRate = parseFloat(d[f+t].bid);
                document.getElementById('infoCotacao').innerText = `1 ${f} = ${currentRate.toFixed(2)} ${t}`;
                atualizarResultado();
            } catch(e) { document.getElementById('infoCotacao').innerText = "Erro"; }
        }

        function atualizarResultado() {
            document.getElementById('calcResultDisplay').innerText = format(rawValues.calcValueDisplay * currentRate, document.getElementById('toCurrency').value);
        }

        function lancarCambio() {
            const res = rawValues.calcValueDisplay * currentRate; if(res === 0) return;
            currentUser.transactions.push({ id: Date.now(), text: `CÃ¢mbio ${document.getElementById('fromCurrency').value}`, amount: -res, date: new Date().toLocaleDateString() });
            save(); render(); switchTab('home');
        }

        function setGuide(dest) {
            const data = restaurantesDB[dest] || restaurantesDB['BRL'];
            document.getElementById('restaurant-list').innerHTML = data.map(res => `
                <div class="bg-white p-5 rounded-3xl border shadow-sm text-left flex items-center gap-4">
                    <div class="text-2xl">${res.icone}</div>
                    <div class="flex-1"><h4 class="font-bold text-slate-800 text-sm">${res.nome}</h4><p class="text-[9px] text-blue-500 font-bold uppercase">${res.cidade} â€¢ ${res.tipo}</p></div>
                    <span class="text-emerald-500 font-black text-xs">${res.preco}</span>
                </div>
            `).join('');
        }

        function switchTab(t) {
            ['home', 'cambio', 'viagem'].forEach(tab => {
                document.getElementById('tab-' + tab).classList.add('hidden');
                document.getElementById('nav-' + tab).classList.replace('tab-active', 'text-slate-400');
            });
            document.getElementById('tab-' + t).classList.remove('hidden');
            document.getElementById('nav-' + t).classList.add('tab-active');
            document.getElementById('nav-' + t).classList.remove('text-slate-400');
        }

        function logout() { location.reload(); }
        function save() { localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser)); }
        function limparTudo() { if(confirm("Zerar?")) { currentUser.transactions = []; save(); render(); } }
    </script>
</body>
</html>
