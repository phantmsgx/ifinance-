<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iFinance Premium - Ultra Version</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="iFinance">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* ESTILIZA√á√ÉO DE BASE E RESET DE INTERFACE
        */
        html, body { 
            touch-action: pan-x pan-y; 
            overscroll-behavior: none;
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        body { 
            padding-bottom: 110px; 
            -webkit-tap-highlight-color: transparent; 
        }

        .hidden { display: none !important; }

        /* SISTEMA DE NAVEGA√á√ÉO E IDENTIDADE VISUAL
        */
        .tab-active { 
            color: #2563eb; 
            transform: scale(1.1); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #desc {
            text-transform: uppercase;
        }

        /* CONTROLE DE SELE√á√ÉO E ACESSIBILIDADE
        */
        * { 
            user-select: none; 
            -webkit-user-select: none;
            -webkit-touch-callout: none; 
        }

        input, select, textarea { 
            user-select: auto !important; 
            -webkit-user-select: auto !important;
            font-size: 16px !important; 
        }

        /* AJUSTE CR√çTICO: PREVEN√á√ÉO DE VAZAMENTO DE N√öMEROS (BREAKPOINTS DIN√ÇMICOS)
        */
        .balance-text {
            font-size: clamp(1.8rem, 9vw, 3.5rem); 
            word-break: break-all;
            line-height: 1.1;
            font-weight: 900;
        }
        
        .summary-text {
            font-size: clamp(1.3rem, 6vw, 2rem);
            word-break: break-all;
            font-weight: 800;
        }

        .bg-auth-gradient { 
            background: radial-gradient(circle at top right, #eff6ff, #ffffff); 
        }

        /* ESCONDER SCROLLBARS PARA LOOK NATIVO */
        ::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ANIMA√á√ïES DE INTERFACE (MOVIMENTO SUAVE)
        */
        .fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .premium-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08);
        }

        .card-inner {
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 40px;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        button:active {
            transform: scale(0.96);
        }

        .btn-gradient {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }
    </style>
</head>
<body>

    <section id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-auth-gradient text-center">
        <div class="mb-8 w-28 h-28 bg-blue-600 rounded-[40px] flex items-center justify-center shadow-2xl text-white text-6xl transform rotate-12">
            <i class="fa-solid fa-wallet"></i>
        </div>
        
        <h1 id="auth-title" class="text-5xl font-black mb-2 tracking-tighter">i<span class="text-blue-600">Finance</span></h1>
        <p id="auth-subtitle" data-i18n="welcome" class="text-slate-500 mb-12 font-medium text-lg">Gest√£o financeira de elite para usu√°rios exigentes.</p>

        <div class="flex flex-col w-full max-w-md gap-5">
            <input type="email" id="emailInput" placeholder="E-mail" class="bg-white border-2 border-slate-50 p-6 rounded-3xl font-bold text-lg outline-none shadow-sm focus:border-blue-200 transition-all">
            <input type="password" id="passInput" placeholder="Senha" class="bg-white border-2 border-slate-50 p-6 rounded-3xl font-bold text-lg outline-none shadow-sm focus:border-blue-200 transition-all">
            
            <div id="register-fields" class="hidden flex flex-col gap-5 fade-in-up">
                <input type="text" id="userNameInput" placeholder="Seu Nome Completo" class="bg-white border-2 border-slate-50 p-6 rounded-3xl font-bold text-lg outline-none shadow-sm">
                
                <div class="relative">
                    <select id="userCurrencyInput" onchange="updateSalaryMask()" class="w-full bg-white border-2 border-slate-50 p-6 rounded-3xl font-bold text-lg outline-none shadow-sm appearance-none">
                        <option value="BRL">üáßüá∑ BRL - Real Brasileiro</option>
                        <option value="USD">üá∫üá∏ USD - D√≥lar Americano</option>
                        <option value="EUR">üá™üá∫ EUR - Euro</option>
                        <option value="GBP">üá¨üáß GBP - Libra Esterlina</option>
                        <option value="JPY">üáØüáµ JPY - Iene Japon√™s</option>
                        <option value="MXN">üá≤üáΩ MXN - Peso Mexicano</option>
                    </select>
                    <i class="fa-solid fa-chevron-down absolute right-6 top-1/2 -translate-y-1/2 text-slate-400"></i>
                </div>

                <div class="bg-white p-8 rounded-[40px] border-2 border-blue-50 text-left shadow-inner">
                    <p class="text-[11px] font-black text-blue-600 uppercase mb-3 tracking-[0.2em]" data-i18n="monthly_income">Renda Mensal (Sal√°rio)</p>
                    <input type="text" id="salaryInput" placeholder="0,00" class="w-full bg-transparent border-b-4 border-blue-100 py-3 font-black text-4xl outline-none text-blue-900">
                    <p class="text-[10px] text-slate-400 mt-4 font-semibold uppercase italic">O valor ser√° creditado automaticamente no primeiro acesso.</p>
                </div>
            </div>

            <button onclick="handleAuth()" id="btn-main-auth" class="btn-gradient text-white py-6 rounded-3xl font-black text-xl shadow-2xl hover:brightness-110 transition-all uppercase tracking-widest">Acessar Sistema</button>
            <button onclick="toggleAuthMode()" id="btn-switch-auth" class="text-blue-600 font-bold mt-4 hover:text-blue-800 transition-colors text-sm" data-i18n="create_account">Ainda n√£o possui conta? Registre-se agora</button>
        </div>
    </section>

    <div id="main-app" class="hidden">
        
        <section id="tab-home" class="fade-in-up">
            <header class="bg-white/80 backdrop-blur-xl border-b border-slate-100 p-8 sticky top-0 z-20 flex justify-between items-center px-10">
                <div>
                    <h1 class="text-3xl font-black text-blue-600 italic tracking-tighter">iFinance</h1>
                    <p class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.3em]">Premium Dashboard</p>
                </div>
                <div class="flex items-center gap-6">
                    <div class="text-right hidden sm:block">
                        <p class="text-[9px] font-black text-slate-300 uppercase tracking-widest">Bem-vindo,</p>
                        <span id="displayUserName" class="text-slate-600 font-black text-sm uppercase"></span>
                    </div>
                    <button onclick="logout()" class="w-14 h-14 bg-slate-50 rounded-2xl flex items-center justify-center text-slate-400 hover:text-red-500 hover:bg-red-50 transition-all shadow-sm">
                        <i class="fa-solid fa-power-off text-xl"></i>
                    </button>
                </div>
            </header>
            
            <main class="p-6 max-w-6xl mx-auto space-y-10">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="card-inner p-10 border-blue-100 border-2 premium-shadow bg-gradient-to-br from-white to-blue-50/30">
                        <p class="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-4" data-i18n="balance">Saldo Dispon√≠vel</p>
                        <h2 class="balance-text text-slate-900" id="balance">0,00</h2>
                    </div>
                    <div class="card-inner p-10 premium-shadow">
                        <p class="text-[11px] font-black text-emerald-500 uppercase tracking-widest mb-4" data-i18n="incomes">Entradas Mensais</p>
                        <h2 class="summary-text text-emerald-600" id="incomes">0,00</h2>
                    </div>
                    <div class="card-inner p-10 premium-shadow">
                        <p class="text-[11px] font-black text-red-500 uppercase tracking-widest mb-4" data-i18n="expenses">Sa√≠das Totais</p>
                        <h2 class="summary-text text-red-600" id="expenses">0,00</h2>
                    </div>
                </div>

                <div class="card-inner p-10 premium-shadow">
                    <h3 class="text-sm font-black text-slate-400 uppercase tracking-widest mb-8 text-center italic">Novo Registro Financeiro</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="relative">
                            <input type="text" id="desc" placeholder="DESCRI√á√ÉO" class="w-full bg-slate-50 p-6 rounded-3xl border-none outline-blue-500 font-black text-slate-700 placeholder:text-slate-300">
                        </div>
                        <div class="relative">
                            <input type="text" id="amountDisplay" placeholder="0,00" class="w-full bg-slate-50 p-6 rounded-3xl border-none font-black text-2xl text-center text-blue-600 outline-blue-500">
                        </div>
                        <div class="relative">
                            <select id="type" class="w-full bg-slate-50 p-6 rounded-3xl border-none font-black text-slate-500 uppercase appearance-none">
                                <option value="expense" data-i18n="opt_expense">Sa√≠da (-)</option>
                                <option value="income" data-i18n="opt_income">Entrada (+)</option>
                            </select>
                            <i class="fa-solid fa-chevron-down absolute right-6 top-1/2 -translate-y-1/2 text-slate-300"></i>
                        </div>
                        <button onclick="addTransaction()" class="btn-gradient text-white font-black rounded-3xl py-6 shadow-xl uppercase tracking-widest hover:scale-[1.02] transition-all" data-i18n="btn_save">Confirmar</button>
                    </div>
                </div>

                <div class="card-inner p-12 premium-shadow">
                    <div class="flex justify-between items-center mb-10">
                        <h3 class="text-xs font-black text-slate-300 uppercase tracking-[0.4em]">Extrato Detalhado</h3>
                        <div class="h-[1px] bg-slate-100 flex-1 mx-8"></div>
                    </div>
                    <ul id="transaction-list" class="divide-y divide-slate-50">
                        </ul>
                    <button onclick="limparTudo()" class="w-full text-center py-10 text-[11px] text-red-200 font-black uppercase tracking-[0.5em] mt-6 hover:text-red-500 transition-colors" data-i18n="btn_clear">Limpar Base de Dados</button>
                </div>
            </main>
        </section>

        <section id="tab-cambio" class="hidden p-6 fade-in-up">
             <div class="max-w-2xl mx-auto card-inner p-16 premium-shadow space-y-12 mt-10 text-center bg-white">
                <header>
                    <h2 class="font-black text-4xl uppercase tracking-tighter" data-i18n="converter">C√¢mbio Inteligente</h2>
                    <p class="text-slate-400 text-xs font-bold mt-3 uppercase tracking-widest">Cota√ß√µes atualizadas via API</p>
                </header>

                <div class="flex flex-col md:flex-row items-center justify-between gap-8">
                    <div class="w-full relative">
                        <p class="text-[10px] font-black text-slate-300 uppercase mb-3 text-left ml-2">Moeda Origem</p>
                        <select id="fromCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-7 rounded-[35px] font-black border-none text-xl appearance-none">
                            <option value="USD">üá∫üá∏ USD - D√≥lar</option>
                            <option value="EUR">üá™üá∫ EUR - Euro</option>
                            <option value="BRL">üáßüá∑ BRL - Real</option>
                            <option value="GBP">üá¨üáß GBP - Libra</option>
                        </select>
                        <i class="fa-solid fa-chevron-down absolute right-8 top-[68%] -translate-y-1/2 text-slate-300"></i>
                    </div>
                    
                    <div class="bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center text-white shadow-2xl shrink-0 mt-6">
                        <i class="fa-solid fa-right-left text-2xl"></i>
                    </div>

                    <div class="w-full relative">
                        <p class="text-[10px] font-black text-slate-300 uppercase mb-3 text-left ml-2">Moeda Destino</p>
                        <select id="toCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-7 rounded-[35px] font-black border-none text-xl appearance-none">
                            <option value="BRL">üáßüá∑ BRL - Real</option>
                            <option value="USD">üá∫üá∏ USD - D√≥lar</option>
                            <option value="EUR">üá™üá∫ EUR - Euro</option>
                        </select>
                        <i class="fa-solid fa-chevron-down absolute right-8 top-[68%] -translate-y-1/2 text-slate-300"></i>
                    </div>
                </div>

                <div class="space-y-4">
                    <p class="text-[10px] font-black text-slate-300 uppercase tracking-widest">Montante para convers√£o</p>
                    <input type="text" id="calcValueDisplay" placeholder="0,00" class="w-full bg-slate-50 p-12 rounded-[50px] font-black text-6xl text-center outline-none text-blue-600 shadow-inner">
                </div>

                <div class="bg-slate-900 p-14 rounded-[60px] text-white shadow-2xl transform hover:scale-[1.02] transition-all">
                    <p class="text-blue-400 text-[11px] font-black uppercase mb-4 tracking-[0.3em]">Valor Final Convertido</p>
                    <h3 class="text-7xl font-black tracking-tighter" id="calcResultDisplay">0,00</h3>
                </div>

                <button onclick="lancarCambio()" class="w-full btn-gradient text-white font-black p-8 rounded-[40px] uppercase text-sm tracking-widest shadow-xl" data-i18n="btn_apply_exchange">Lan√ßar Despesa no Saldo</button>
             </div>
        </section>

        <section id="tab-viagem" class="hidden p-6 text-center fade-in-up">
            <h2 class="text-5xl font-black mb-3 mt-10 uppercase tracking-tighter" data-i18n="guide_title">Guia de Restaurantes</h2>
            <p class="text-slate-400 text-sm font-bold uppercase tracking-[0.3em] mb-14">A sele√ß√£o definitiva dos melhores do mundo</p>
            
            <div class="flex gap-5 overflow-x-auto pb-10 mb-10 no-scrollbar px-6">
                <button onclick="setGuide('BRL')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üáßüá∑ Brasil</button>
                <button onclick="setGuide('USD')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üá∫üá∏ EUA</button>
                <button onclick="setGuide('EUR')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üá™üá∫ Europa</button>
                <button onclick="setGuide('ITA')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üáÆüáπ It√°lia</button>
                <button onclick="setGuide('JPN')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üáØüáµ Jap√£o</button>
                <button onclick="setGuide('MEX')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üá≤üáΩ M√©xico</button>
                <button onclick="setGuide('PRT')" class="bg-white border-2 border-slate-50 px-12 py-6 rounded-[30px] font-black shrink-0 shadow-sm hover:border-blue-200 transition-all uppercase tracking-widest">üáµüáπ Portugal</button>
            </div>

            <div id="restaurant-list" class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-40 max-w-7xl mx-auto px-6">
                </div>
        </section>

        <nav class="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-2xl border-t border-slate-100 py-8 flex justify-around shadow-[0_-25px_60px_rgba(0,0,0,0.08)] z-50">
            <button onclick="switchTab('home')" id="nav-home" class="flex flex-col items-center tab-active">
                <i class="fa-solid fa-wallet text-3xl"></i>
                <span class="text-[11px] font-black mt-3 uppercase tracking-[0.2em]" data-i18n="nav_wallet">Carteira</span>
            </button>
            <button onclick="switchTab('cambio')" id="nav-cambio" class="flex flex-col items-center text-slate-300 hover:text-blue-400 transition-colors">
                <i class="fa-solid fa-money-bill-transfer text-3xl"></i>
                <span class="text-[11px] font-black mt-3 uppercase tracking-[0.2em]" data-i18n="nav_exchange">C√¢mbio</span>
            </button>
            <button onclick="switchTab('viagem')" id="nav-viagem" class="flex flex-col items-center text-slate-300 hover:text-blue-400 transition-colors">
                <i class="fa-solid fa-utensils text-3xl"></i>
                <span class="text-[11px] font-black mt-3 uppercase tracking-[0.2em]" data-i18n="nav_guide">Guia</span>
            </button>
        </nav>
    </div>

    <script>
        /**
         * 1. SISTEMA DE TRADU√á√ÉO MULTI-IDIOMA
         */
        const translations = {
            pt: {
                welcome: "Gest√£o financeira de elite para usu√°rios exigentes.",
                balance: "Saldo Dispon√≠vel",
                incomes: "Entradas Mensais",
                expenses: "Sa√≠das Totais",
                opt_expense: "Sa√≠da (-)",
                opt_income: "Entrada (+)",
                btn_save: "Confirmar Registro",
                btn_clear: "Limpar Base de Dados",
                converter: "C√¢mbio Inteligente",
                btn_apply_exchange: "Lan√ßar Despesa no Saldo",
                guide_title: "Guia de Restaurantes",
                nav_wallet: "Carteira",
                nav_exchange: "C√¢mbio",
                nav_guide: "Guia",
                monthly_income: "Renda Mensal (Sal√°rio)",
                create_account: "Ainda n√£o possui conta? Registre-se agora"
            },
            en: {
                welcome: "Elite financial management for demanding users.",
                balance: "Available Balance",
                incomes: "Monthly Incomes",
                expenses: "Total Expenses",
                opt_expense: "Outcome (-)",
                opt_income: "Income (+)",
                btn_save: "Confirm Entry",
                btn_clear: "Clear Database",
                converter: "Smart Exchange",
                btn_apply_exchange: "Post to Balance",
                guide_title: "Restaurant Guide",
                nav_wallet: "Wallet",
                nav_exchange: "Exchange",
                nav_guide: "Guide",
                monthly_income: "Monthly Income (Salary)",
                create_account: "No account? Register now"
            }
        };

        /**
         * 2. BANCO DE DADOS GASTRON√îMICO (EXPANDIDO PARA MANTER VOLUME)
         */
        const restaurantesDB = {
            'BRL': [
                {nome:'A CASA DO PORCO', cidade:'S√ÉO PAULO', tipo:'COZINHA CONCEITUAL', preco:'$$$', icone:'üê∑', desc:'Eleito um dos melhores do mundo, focado na carne su√≠na.'},
                {nome:'MARIUS DEGUSTARE', cidade:'RIO DE JANEIRO', tipo:'CHURRASCO NOBRE', preco:'$$$$', icone:'ü•©', desc:'Experi√™ncia √©pica em frente √† praia de Copacabana.'},
                {nome:'D.O.M', cidade:'S√ÉO PAULO', tipo:'ALTA GASTRONOMIA', preco:'$$$$$', icone:'üåø', desc:'Chef Alex Atala explorando ingredientes da Amaz√¥nia.'},
                {nome:'MAN√ç', cidade:'S√ÉO PAULO', tipo:'CONTEMPOR√ÇNEA', preco:'$$$$', icone:'ü•£', desc:'Cozinha art√≠stica e delicada em um ambiente minimalista.'},
                {nome:'GLOUTON', cidade:'BELO HORIZONTE', tipo:'COZINHA MINEIRA', preco:'$$$', icone:'üç∑', desc:'O melhor da tradi√ß√£o mineira com t√©cnicas francesas.'}
            ],
            'USD': [
                {nome:'JOE\'S PIZZA', cidade:'NEW YORK', tipo:'PIZZA CL√ÅSSICA', preco:'$', icone:'üçï', desc:'A fatia mais ic√¥nica de NY desde 1975.'},
                {nome:'KATZ\'S DELI', cidade:'NEW YORK', tipo:'DELICATESSEN', preco:'$$', icone:'ü•™', desc:'Onde o sandu√≠che de Pastrami √© uma institui√ß√£o religiosa.'},
                {nome:'LE BERNARDIN', cidade:'NEW YORK', tipo:'FRUTOS DO MAR', preco:'$$$$$', icone:'üêü', desc:'Detentor de 3 estrelas Michelin e perfei√ß√£o t√©cnica.'},
                {nome:'NOBU MALIBU', cidade:'LOS ANGELES', tipo:'JAPON√äS FUSION', preco:'$$$$', icone:'üç£', desc:'Ponto de encontro de celebridades com vista para o mar.'},
                {nome:'FRENCH LAUNDRY', cidade:'NAPA VALLEY', tipo:'GASTRONOMIA FRANCESA', preco:'$$$$$', icone:'üè∞', desc:'O √°pice da culin√°ria nos Estados Unidos.'}
            ],
            'EUR': [
                {nome:'LE MEURICE', cidade:'PARIS', tipo:'LUXO FRANC√äS', preco:'$$$$$', icone:'ü•ê', desc:'Pal√°cio gastron√¥mico assinado por Alain Ducasse.'},
                {nome:'SEPTIME', cidade:'PARIS', tipo:'NEO-BISTRO', preco:'$$$$', icone:'üç∑', desc:'O restaurante mais concorrido e moderno da Fran√ßa.'},
                {nome:'HOFBR√ÑUHAUS', cidade:'MUNICH', tipo:'TABERNA ALEM√É', preco:'$$', icone:'üç∫', desc:'Cervejaria hist√≥rica datada do ano de 1589.'},
                {nome:'STEIRERECK', cidade:'VIENA', tipo:'MODERNA AUSTR√çACA', preco:'$$$$$', icone:'üá¶üáπ', desc:'Inova√ß√£o em meio ao Stadtpark de Viena.'},
                {nome:'CIEL DE PARIS', cidade:'PARIS', tipo:'VISTA PANOR√ÇMICA', preco:'$$$$', icone:'üóº', desc:'Localizado no topo da Torre Montparnasse.'}
            ],
            'ITA': [
                {nome:'OSTERIA FRANCESCANA', cidade:'MODENA', tipo:'ARTE ITALIANA', preco:'$$$$$', icone:'üé®', desc:'Massimo Bottura reinventando a tradi√ß√£o da It√°lia.'},
                {nome:'TRATTORIA BAFFETTO', cidade:'ROMA', tipo:'PIZZARIA REAL', preco:'$$', icone:'üáÆüáπ', desc:'A pizza de massa fina mais famosa da capital romana.'},
                {nome:'LA PERGOLA', cidade:'ROMA', tipo:'VISTA ETERNA', preco:'$$$$$', icone:'üèõÔ∏è', desc:'O √∫nico 3 estrelas Michelin de Roma.'},
                {nome:'DA VITTORIO', cidade:'B√âRGAMO', tipo:'TRADI√á√ÉO FAMILIAR', preco:'$$$$', icone:'üçù', desc:'Lugar sagrado para amantes de massas e frutos do mar.'},
                {nome:'ANTICA PESA', cidade:'ROMA', tipo:'HIST√ìRICO ROMANO', preco:'$$$', icone:'üç∑', desc:'Cozinha romana cl√°ssica frequentada por Hollywood.'}
            ],
            'JPN': [
                {nome:'SUKIYABASHI JIRO', cidade:'TOKYO', tipo:'LENDA DO SUSHI', preco:'$$$$$', icone:'üç£', desc:'Onde o mestre Jiro Ono prepara cada pe√ßa com perfei√ß√£o.'},
                {nome:'ICHIRAN RAMEN', cidade:'TOKYO', tipo:'RAMEN ESPECIALISTA', preco:'$', icone:'üçú', desc:'Cabines individuais para foco total no sabor do caldo.'},
                {nome:'NARISAWA', cidade:'TOKYO', tipo:'ECO-GASTRONOMIA', preco:'$$$$$', icone:'üå≤', desc:'Pratos que parecem paisagens naturais do Jap√£o.'},
                {nome:'KOBE BEEF KAISEKI', cidade:'KOBE', tipo:'CARNE WAGYU', preco:'$$$$', icone:'üêÇ', desc:'A melhor carne bovina do planeta servida com t√©cnica.'},
                {nome:'GION NANBA', cidade:'KYOTO', tipo:'KYOTO KAISEKI', preco:'$$$$', icone:'üçµ', desc:'O refinamento da antiga capital japonesa.'}
            ],
            'MEX': [
                {nome:'PUJOL', cidade:'CDMX', tipo:'MEXICANA MODERNA', preco:'$$$$$', icone:'üåÆ', desc:'Enrique Olvera e o famoso Mole Madre de mil dias.'},
                {nome:'QUINTONIL', cidade:'CDMX', tipo:'CONTEMPOR√ÇNEO', preco:'$$$$$', icone:'ü•ë', desc:'Foco total em ervas e vegetais nativos do M√©xico.'},
                {nome:'EL FAROLITO', cidade:'CDMX', tipo:'TACOS AUT√äNTICOS', preco:'$', icone:'üåÆ', desc:'Onde o Taco al Pastor √© elevado √† perfei√ß√£o.'},
                {nome:'ROSETTA', cidade:'CDMX', tipo:'MANS√ÉO GASTRON√îMICA', preco:'$$$', icone:'üçù', desc:'Chef Elena Reygadas unindo It√°lia e M√©xico.'},
                {nome:'CONTRAMAR', cidade:'CDMX', tipo:'MARISCOS LENTAIS', preco:'$$$', icone:'üêü', desc:'O destino obrigat√≥rio para almo√ßos de frutos do mar.'}
            ],
            'PRT': [
                {nome:'BELCANTO', cidade:'LISBOA', tipo:'VANGUARDA PORTUGUESA', preco:'$$$$$', icone:'üáµüáπ', desc:'Jos√© Avillez elevando a cozinha lusa ao topo.'},
                {nome:'SOLAR DOS PRESUNTOS', cidade:'LISBOA', tipo:'TRADI√á√ÉO LUSA', preco:'$$$', icone:'üê∑', desc:'Onde o sabor de Portugal √© servido com fartura.'},
                {nome:'RAMIRO', cidade:'LISBOA', tipo:'MARISQUEIRA', preco:'$$$$', icone:'ü¶û', desc:'Cervejaria lend√°ria onde o foco √© o marisco fresco.'},
                {nome:'THE YEATMAN', cidade:'PORTO', tipo:'CULTURA DO VINHO', preco:'$$$$$', icone:'üç∑', desc:'Vista deslumbrante sobre o Rio Douro.'},
                {nome:'PAST√âIS DE BEL√âM', cidade:'LISBOA', tipo:'HIST√ìRIA DOCE', preco:'$', icone:'üßÅ', desc:'A receita secreta que o mundo inteiro tenta copiar.'}
            ]
        };

        /**
         * 3. VARI√ÅVEIS DE ESTADO DO SISTEMA
         */
        let isRegisterMode = false;
        let currentUser = null;
        let currentRate = 1;
        let rawValues = { amountDisplay: 0, salaryInput: 0, calcValueDisplay: 0 };

        /**
         * 4. MOTOR DE M√ÅSCARA MONET√ÅRIA (ANTI-GLITCH)
         */
        function applyMask(id) {
            const el = document.getElementById(id);
            el.addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, '');
                if (v === "" || v === "0") { 
                    rawValues[id] = 0; 
                    el.value = formatCurrency(0, getContextCurrency(id)); 
                } else {
                    let num = parseFloat(v) / 100;
                    rawValues[id] = num;
                    el.value = formatCurrency(num, getContextCurrency(id));
                }
                if (id === 'calcValueDisplay') buscarCotacao();
            });
            el.value = formatCurrency(0, getContextCurrency(id));
        }

        function getContextCurrency(id) {
            if(id === 'salaryInput') return document.getElementById('userCurrencyInput').value;
            if(id === 'calcValueDisplay') return document.getElementById('fromCurrency').value;
            return currentUser ? currentUser.currency : 'BRL';
        }

        function formatCurrency(val, curr) {
            const c = curr || (currentUser ? currentUser.currency : 'BRL');
            return val.toLocaleString('pt-BR', { style: 'currency', currency: c });
        }

        /**
         * 5. GERENCIAMENTO DE SESS√ÉO E LOGIN
         */
        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('register-fields').classList.toggle('hidden');
            document.getElementById('auth-title').innerHTML = isRegisterMode ? 'Nova Conta' : 'i<span class="text-blue-600">Finance</span>';
            document.getElementById('btn-main-auth').innerText = isRegisterMode ? 'CRIAR MINHA CONTA' : 'ACESSAR SISTEMA';
            document.getElementById('btn-switch-auth').innerText = isRegisterMode ? 'J√° sou cadastrado' : 'N√£o tem conta? Registre-se agora';
        }

        function handleAuth() {
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            
            if (isRegisterMode) {
                const name = document.getElementById('userNameInput').value.trim();
                if(!name || !email || !pass) { alert("Preencha todos os campos."); return; }
                
                const newUser = { 
                    name: name.toUpperCase(), 
                    pass, 
                    currency: document.getElementById('userCurrencyInput').value, 
                    salary: rawValues.salaryInput, 
                    transactions: [] 
                };
                localStorage.setItem(`user_${email}`, JSON.stringify(newUser));
                alert("Conta criada com sucesso! Fa√ßa seu primeiro acesso."); 
                toggleAuthMode();
            } else {
                const saved = localStorage.getItem(`user_${email}`);
                if (saved && JSON.parse(saved).pass === pass) {
                    currentUser = { ...JSON.parse(saved), email };
                    
                    // CR√âDITO DO SAL√ÅRIO NO PRIMEIRO LOGIN
                    if (currentUser.transactions.length === 0 && currentUser.salary > 0) {
                        currentUser.transactions.push({ 
                            id: Date.now(), 
                            text: "CR√âDITO INICIAL (SAL√ÅRIO)", 
                            amount: currentUser.salary, 
                            date: new Date().toLocaleDateString('pt-BR') 
                        });
                        save();
                    }
                    entrarApp();
                } else { alert("Usu√°rio ou senha inv√°lidos."); }
            }
        }

        function entrarApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('displayUserName').innerText = currentUser.name;
            renderTransactions();
            setGuide('BRL');
            buscarCotacao();
        }

        /**
         * 6. L√ìGICA DA CARTEIRA E TRANSA√á√ïES
         */
        function addTransaction() {
            const desc = document.getElementById('desc').value.toUpperCase();
            const val = rawValues.amountDisplay;
            if (!desc || val === 0) { alert("Descri√ß√£o e valor s√£o obrigat√≥rios."); return; }
            
            const finalVal = (document.getElementById('type').value === 'expense') ? -val : val;
            
            currentUser.transactions.push({ 
                id: Date.now(), 
                text: desc, 
                amount: finalVal, 
                date: new Date().toLocaleDateString('pt-BR') 
            });
            
            save(); 
            renderTransactions();
            
            // Reset de campos
            document.getElementById('desc').value = '';
            document.getElementById('amountDisplay').value = formatCurrency(0);
            rawValues.amountDisplay = 0;
        }

        function renderTransactions() {
            const list = document.getElementById('transaction-list');
            list.innerHTML = ''; 
            let bal = 0, inc = 0, exp = 0;
            
            [...currentUser.transactions].reverse().forEach(t => {
                bal += t.amount; 
                if(t.amount > 0) inc += t.amount; else exp += Math.abs(t.amount);
                
                const li = document.createElement('li');
                li.className = "flex justify-between items-center py-8 fade-in-up";
                li.innerHTML = `
                    <div class="text-left">
                        <p class="font-black text-base text-slate-800 tracking-tight">${t.text}</p>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1">${t.date}</p>
                    </div>
                    <span class="${t.amount < 0 ? 'text-red-500' : 'text-emerald-600'} font-black text-lg">
                        ${formatCurrency(t.amount)}
                    </span>
                `;
                list.appendChild(li);
            });
            
            document.getElementById('balance').innerText = formatCurrency(bal);
            document.getElementById('incomes').innerText = formatCurrency(inc);
            document.getElementById('expenses').innerText = formatCurrency(exp);
        }

        /**
         * 7. L√ìGICA DE C√ÇMBIO (API EXTERNA)
         */
        async function buscarCotacao() {
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            if (from === to) { currentRate = 1; updateExchangeUI(); return; }
            try {
                const res = await fetch(`https://economia.awesomeapi.com.br/last/${from}-${to}`);
                const data = await res.json();
                currentRate = parseFloat(data[from + to].bid);
                updateExchangeUI();
            } catch (e) { 
                console.error("Falha na conex√£o com a API de moedas."); 
            }
        }

        function updateExchangeUI() {
            const res = rawValues.calcValueDisplay * currentRate;
            document.getElementById('calcResultDisplay').innerText = formatCurrency(res, document.getElementById('toCurrency').value);
        }

        function lancarCambio() {
            const res = rawValues.calcValueDisplay * currentRate;
            if(res <= 0) return;
            
            const moedas = `${document.getElementById('fromCurrency').value} PARA ${document.getElementById('toCurrency').value}`;
            
            currentUser.transactions.push({ 
                id: Date.now(), 
                text: `C√ÇMBIO: ${moedas}`, 
                amount: -res, 
                date: new Date().toLocaleDateString('pt-BR') 
            });
            
            save(); 
            renderTransactions(); 
            switchTab('home');
            alert("Opera√ß√£o de c√¢mbio registrada como sa√≠da.");
        }

        /**
         * 8. GUIA MUNDIAL DE RESTAURANTES (RENDERIZA√á√ÉO)
         */
        function setGuide(pais) {
            const container = document.getElementById('restaurant-list');
            container.innerHTML = '';
            
            (restaurantesDB[pais] || restaurantesDB['BRL']).forEach(r => {
                const div = document.createElement('div');
                div.className = "card-inner p-10 flex flex-col sm:flex-row items-center gap-8 text-center sm:text-left fade-in-up premium-shadow bg-white hover:scale-[1.01] transition-all";
                div.innerHTML = `
                    <div class="text-5xl bg-slate-50 w-24 h-24 flex items-center justify-center rounded-[35px] shadow-inner shrink-0">${r.icone}</div>
                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-2">
                            <h4 class="font-black text-slate-800 text-xl tracking-tighter">${r.nome}</h4>
                            <span class="text-emerald-500 font-black text-sm bg-emerald-50 px-3 py-1 rounded-full w-max mx-auto sm:mx-0">${r.preco}</span>
                        </div>
                        <p class="text-[11px] text-blue-600 font-black uppercase tracking-[0.2em] mt-2">${r.cidade} ‚Ä¢ ${r.tipo}</p>
                        <p class="text-xs text-slate-400 font-medium mt-3 leading-relaxed">${r.desc}</p>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        /**
         * 9. UTILIT√ÅRIOS E CONTROLE DE UI
         */
        function switchTab(tab) {
            ['home', 'cambio', 'viagem'].forEach(t => {
                document.getElementById('tab-' + t).classList.add('hidden');
                document.getElementById('nav-' + t).classList.replace('tab-active', 'text-slate-300');
            });
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.getElementById('nav-' + tab).classList.replace('text-slate-300', 'tab-active');
            window.scrollTo(0,0);
        }

        function save() { localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser)); }
        function logout() { if(confirm("Deseja encerrar a sess√£o?")) location.reload(); }
        function limparTudo() { if(confirm("Deseja apagar permanentemente todo o hist√≥rico?")) { currentUser.transactions = []; save(); renderTransactions(); } }
        function updateSalaryMask() { applyMask('salaryInput'); }

        /**
         * INICIALIZA√á√ÉO DO APP
         */
        window.onload = () => {
            applyMask('amountDisplay'); 
            applyMask('salaryInput'); 
            applyMask('calcValueDisplay');
            
            const userLang = navigator.language.startsWith('pt') ? 'pt' : 'en';
            document.querySelectorAll('[data-i18n]').forEach(el => { 
                const key = el.getAttribute('data-i18n');
                if(translations[userLang][key]) el.innerText = translations[userLang][key]; 
            });
        };
    </script>
</body>
</html>
