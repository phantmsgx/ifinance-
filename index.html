<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iFinance Premium</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* ESTILOS GERAIS E BLOQUEIO DE ZOOM */
        html, body { 
            touch-action: pan-x pan-y; 
            overscroll-behavior: none;
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            color: #0f172a;
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
        }

        body { 
            padding-bottom: 90px; 
            -webkit-tap-highlight-color: transparent; 
        }

        .hidden { display: none !important; }

        .tab-active { 
            color: #2563eb; 
            transform: scale(1.1); 
            transition: all 0.2s ease;
        }

        /* IMPEDIR SELEÃ‡ÃƒO DE TEXTO PARA PARECER APP */
        * { 
            user-select: none; 
            -webkit-user-select: none;
            -webkit-touch-callout: none; 
        }

        /* PERMITIR SELEÃ‡ÃƒO APENAS EM INPUTS */
        input, select, textarea { 
            user-select: auto; 
            -webkit-user-select: auto;
            font-size: 16px !important; /* Essencial para nÃ£o dar zoom no iPhone */
        }

        .bg-auth { 
            background: radial-gradient(circle at top right, #eff6ff, #ffffff); 
        }

        /* ESCONDER SCROLLBARS */
        ::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ANIMAÃ‡Ã•ES */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

    <section id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-auth text-center">
        <div class="mb-6 w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center shadow-xl text-white text-4xl">
            <i class="fa-solid fa-wallet"></i>
        </div>
        
        <h1 id="auth-title" class="text-4xl font-black mb-2">i<span class="text-blue-600">Finance</span></h1>
        <p id="auth-subtitle" class="text-slate-500 mb-8 font-medium">Sua jornada financeira comeÃ§a aqui.</p>

        <div class="flex flex-col w-full max-w-sm gap-4">
            <input type="email" id="emailInput" placeholder="E-mail" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm border-slate-100">
            <input type="password" id="passInput" placeholder="Senha" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm border-slate-100">
            
            <div id="register-fields" class="hidden flex flex-col gap-4 fade-in">
                <input type="text" id="userNameInput" placeholder="Como quer ser chamado?" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm border-slate-100">
                
                <select id="userCurrencyInput" onchange="updateSalaryMask()" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm border-slate-100">
                    <option value="BRL">ðŸ‡§ðŸ‡· BRL - Real</option>
                    <option value="USD">ðŸ‡ºðŸ‡¸ USD - DÃ³lar</option>
                    <option value="EUR">ðŸ‡ªðŸ‡º EUR - Euro</option>
                    <option value="GBP">ðŸ‡¬ðŸ‡§ GBP - Libra</option>
                    <option value="JPY">ðŸ‡¯ðŸ‡µ JPY - Iene</option>
                    <option value="MXN">ðŸ‡²ðŸ‡½ MXN - Peso Mexicano</option>
                    <option value="CHF">ðŸ‡¨ðŸ‡­ CHF - Franco SuÃ­Ã§o</option>
                    <option value="BTC">â‚¿ BTC - Bitcoin</option>
                </select>

                <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100 text-left">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-2 tracking-widest">ConfiguraÃ§Ã£o de Renda Mensal</p>
                    <input type="text" id="salaryInput" placeholder="0,00" class="w-full bg-transparent border-b border-blue-200 py-2 font-bold text-xl outline-none">
                    <p class="text-[9px] text-blue-400 mt-2">Este valor serÃ¡ adicionado ao seu saldo todo inÃ­cio de mÃªs.</p>
                </div>
            </div>

            <button onclick="handleAuth()" id="btn-main-auth" class="bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition">Entrar</button>
            <button onclick="toggleAuthMode()" id="btn-switch-auth" class="text-blue-600 font-bold mt-2">Criar conta gratuita</button>
        </div>
    </section>

    <div id="main-app" class="hidden">
        
        <section id="tab-home" class="fade-in">
            <header class="bg-white border-b p-4 sticky top-0 z-10 flex justify-between items-center px-8">
                <h1 class="text-xl font-extrabold text-blue-600 italic">iFinance</h1>
                <div class="flex items-center gap-4">
                    <span id="displayUserName" class="text-slate-500 font-bold text-sm"></span>
                    <button onclick="logout()"><i class="fa-solid fa-right-from-bracket text-slate-300"></i></button>
                </div>
            </header>
            
            <main class="p-6 max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-center">
                    <div class="bg-white p-6 rounded-2xl border-2 border-blue-50 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-tighter">Saldo DisponÃ­vel</p>
                        <h2 class="text-3xl font-black" id="balance">0,00</h2>
                        <div class="mt-2 inline-flex items-center px-3 py-1 bg-blue-100 rounded-full">
                            <span class="text-[9px] font-black text-blue-600 uppercase">SalÃ¡rio: <span id="displaySalary">0,00</span></span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-green-500 uppercase tracking-tighter">Entradas</p>
                        <h2 class="text-2xl font-black text-green-600" id="incomes">0,00</h2>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-red-500 uppercase tracking-tighter">SaÃ­das</p>
                        <h2 class="text-2xl font-black text-red-600" id="expenses">0,00</h2>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl border mb-10 grid grid-cols-1 md:grid-cols-4 gap-4 shadow-sm">
                    <input type="text" id="desc" placeholder="O que vocÃª comprou?" class="bg-slate-50 p-4 rounded-2xl border-none outline-blue-500 font-medium">
                    <input type="text" id="amountDisplay" placeholder="0,00" class="bg-slate-50 p-4 rounded-2xl border-none font-bold text-lg outline-blue-500 text-center">
                    <select id="type" class="bg-slate-50 p-4 rounded-2xl border-none font-bold">
                        <option value="expense">Gastei (SaÃ­da)</option>
                        <option value="income">Recebi (Entrada)</option>
                    </select>
                    <button onclick="addTransaction()" class="bg-blue-600 text-white font-bold rounded-2xl py-4 shadow-lg active:scale-95 transition">Salvar LanÃ§amento</button>
                </div>

                <div class="bg-white p-6 rounded-3xl border shadow-sm">
                    <h3 class="font-black text-slate-400 text-[10px] uppercase tracking-widest mb-4 px-2">HistÃ³rico de MovimentaÃ§Ãµes</h3>
                    <ul id="transaction-list" class="divide-y divide-slate-50">
                        </ul>
                    <button onclick="limparTudo()" class="w-full text-center py-4 text-[10px] text-red-300 font-bold uppercase tracking-widest mt-4">Zerar HistÃ³rico</button>
                </div>
            </main>
        </section>

        <section id="tab-cambio" class="hidden p-6 fade-in">
             <div class="max-w-md mx-auto bg-white p-8 rounded-[40px] border shadow-sm space-y-6 mt-4">
                <h2 class="text-center font-black text-xl">Conversor Global</h2>
                
                <div class="flex items-center justify-between gap-4">
                    <select id="fromCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                        <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                        <option value="BRL">ðŸ‡§ðŸ‡· BRL</option>
                        <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                        <option value="JPY">ðŸ‡¯ðŸ‡µ JPY</option>
                    </select>
                    <i class="fa-solid fa-repeat text-blue-500"></i>
                    <select id="toCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="BRL">ðŸ‡§ðŸ‡· BRL</option>
                        <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                        <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                    </select>
                </div>

                <input type="text" id="calcValueDisplay" placeholder="0,00" class="w-full bg-slate-50 p-6 rounded-2xl font-bold text-3xl border-none text-center outline-none">
                
                <div class="text-center py-2">
                    <span id="infoCotacao" class="text-blue-500 font-bold bg-blue-50 px-4 py-2 rounded-full text-[10px]">Carregando cotaÃ§Ã£o...</span>
                </div>

                <div class="bg-blue-600 p-8 rounded-[32px] text-center shadow-xl">
                    <p class="text-blue-200 text-[10px] font-black mb-1 uppercase tracking-widest">Valor Convertido</p>
                    <h3 class="text-4xl font-black text-white" id="calcResultDisplay">0,00</h3>
                </div>

                <button onclick="lancarCambio()" class="w-full bg-slate-900 text-white font-black p-5 rounded-2xl shadow-lg active:scale-95 transition text-xs uppercase tracking-widest">LanÃ§ar no Saldo Principal</button>
             </div>
        </section>

        <section id="tab-viagem" class="hidden p-6 text-center fade-in">
            <h2 class="text-2xl font-black mb-6 mt-4">Guia de Restaurantes Premium</h2>
            
            <div class="flex gap-2 overflow-x-auto pb-4 mb-4 no-scrollbar">
                <button onclick="setGuide('BRL')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡§ðŸ‡· Brasil</button>
                <button onclick="setGuide('USD')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡ºðŸ‡¸ EUA</button>
                <button onclick="setGuide('EUR')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡ªðŸ‡º Europa</button>
                <button onclick="setGuide('ITA')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡®ðŸ‡¹ ItÃ¡lia</button>
                <button onclick="setGuide('JPN')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡¯ðŸ‡µ JapÃ£o</button>
                <button onclick="setGuide('MEX')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡²ðŸ‡½ MÃ©xico</button>
                <button onclick="setGuide('PRT')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm shrink-0 active:bg-blue-600 active:text-white transition">ðŸ‡µðŸ‡¹ Portugal</button>
            </div>

            <div id="restaurant-list" class="space-y-4 pb-24">
                </div>
        </section>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t py-4 flex justify-around shadow-2xl z-50">
            <button onclick="switchTab('home')" id="nav-home" class="flex flex-col items-center tab-active">
                <i class="fa-solid fa-wallet text-xl"></i>
                <span class="text-[9px] font-black mt-1 uppercase">Carteira</span>
            </button>
            <button onclick="switchTab('cambio')" id="nav-cambio" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-money-bill-transfer text-xl"></i>
                <span class="text-[9px] font-black mt-1 uppercase">CÃ¢mbio</span>
            </button>
            <button onclick="switchTab('viagem')" id="nav-viagem" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-utensils text-xl"></i>
                <span class="text-[9px] font-black mt-1 uppercase">Guia</span>
            </button>
        </nav>
    </div>

    <script>
        // BANCO DE DADOS DOS RESTAURANTES (5 POR PAÃS)
        const restaurantesDB = {
            'BRL': [
                {nome:'A Casa do Porco', cidade:'SÃ£o Paulo', tipo:'Autoral', preco:'$$$', icone:'ðŸ·'},
                {nome:'Marius Degustare', cidade:'Rio de Janeiro', tipo:'Churrasco', preco:'$$$$', icone:'ðŸ¥©'},
                {nome:'D.O.M', cidade:'SÃ£o Paulo', tipo:'Fina', preco:'$$$$$', icone:'ðŸŒ¿'},
                {nome:'ManÃ­', cidade:'SÃ£o Paulo', tipo:'ContemporÃ¢nea', preco:'$$$$', icone:'ðŸ¥£'},
                {nome:'Glouton', cidade:'Belo Horizonte', tipo:'Mineira Moderno', preco:'$$$', icone:'ðŸ·'}
            ],
            'USD': [
                {nome:'Joe\'s Pizza', cidade:'New York', tipo:'Pizza', preco:'$', icone:'ðŸ•'},
                {nome:'Katz\'s Deli', cidade:'New York', tipo:'SanduÃ­che', preco:'$$', icone:'ðŸ¥ª'},
                {nome:'Le Bernardin', cidade:'New York', tipo:'Frutos do Mar', preco:'$$$$$', icone:'ðŸŸ'},
                {nome:'Nobu Malibu', cidade:'Los Angeles', tipo:'JaponÃªs', preco:'$$$$', icone:'ðŸ£'},
                {nome:'French Laundry', cidade:'Napa Valley', tipo:'FrancÃªs', preco:'$$$$$', icone:'ðŸ°'}
            ],
            'EUR': [
                {nome:'Le Meurice', cidade:'Paris', tipo:'Luxo FrancÃªs', preco:'$$$$$', icone:'ðŸ¥'},
                {nome:'Septime', cidade:'Paris', tipo:'Moderno', preco:'$$$$', icone:'ðŸ·'},
                {nome:'HofbrÃ¤uhaus', cidade:'Munique', tipo:'AlemÃ£ Tradicional', preco:'$$', icone:'ðŸº'},
                {nome:'Steirereck', cidade:'Viena', tipo:'Criativa', preco:'$$$$$', icone:'ðŸ‡¦ðŸ‡¹'},
                {nome:'Ciel de Paris', cidade:'Paris', tipo:'Vista PanorÃ¢mica', preco:'$$$$', icone:'ðŸ—¼'}
            ],
            'ITA': [
                {nome:'Osteria Francescana', cidade:'Modena', tipo:'Criativa', preco:'$$$$$', icone:'ðŸŽ¨'},
                {nome:'Trattoria Baffetto', cidade:'Roma', tipo:'Pizza Italiana', preco:'$$', icone:'ðŸ‡®ðŸ‡¹'},
                {nome:'La Pergola', cidade:'Roma', tipo:'Gourmet Luxo', preco:'$$$$$', icone:'ðŸ›ï¸'},
                {nome:'Da Vittorio', cidade:'BÃ©rgamo', tipo:'Peixes e Massas', preco:'$$$$', icone:'ðŸ'},
                {nome:'Antica Pesa', cidade:'Roma', tipo:'HistÃ³rico', preco:'$$$', icone:'ðŸ·'}
            ],
            'JPN': [
                {nome:'Sukiyabashi Jiro', cidade:'TÃ³quio', tipo:'Sushi Master', preco:'$$$$$', icone:'ðŸ£'},
                {nome:'Ichiran Ramen', cidade:'TÃ³quio', tipo:'Ramen Tradicional', preco:'$', icone:'ðŸœ'},
                {nome:'Narisawa', cidade:'TÃ³quio', tipo:'Experimental', preco:'$$$$$', icone:'ðŸŒ²'},
                {nome:'Kobe Beef Kaiseki', cidade:'Kobe', tipo:'Wagyu Premium', preco:'$$$$', icone:'ðŸ‚'},
                {nome:'Gion Nanba', cidade:'Quioto', tipo:'Kaiseki', preco:'$$$$', icone:'ðŸµ'}
            ],
            'MEX': [
                {nome:'Pujol', cidade:'CDMX', tipo:'Mexicana Raiz', preco:'$$$$$', icone:'ðŸŒ®'},
                {nome:'Quintonil', cidade:'CDMX', tipo:'Moderna', preco:'$$$$$', icone:'ðŸ¥‘'},
                {nome:'El Farolito', cidade:'CDMX', tipo:'Tacos AutÃªnticos', preco:'$', icone:'ðŸŒ®'},
                {nome:'Rosetta', cidade:'CDMX', tipo:'FusÃ£o Italiana', preco:'$$$', icone:'ðŸ'},
                {nome:'Contramar', cidade:'CDMX', tipo:'Frutos do Mar', preco:'$$$', icone:'ðŸŸ'}
            ],
            'PRT': [
                {nome:'Belcanto', cidade:'Lisboa', tipo:'Portuguesa Criativa', preco:'$$$$$', icone:'ðŸ‡µðŸ‡¹'},
                {nome:'Solar dos Presuntos', cidade:'Lisboa', tipo:'Regional', preco:'$$$', icone:'ðŸ·'},
                {nome:'Ramiro', cidade:'Lisboa', tipo:'Mariscos', preco:'$$$$', icone:'ðŸ¦ž'},
                {nome:'The Yeatman', cidade:'Porto', tipo:'Alta Gastronomia', preco:'$$$$$', icone:'ðŸ·'},
                {nome:'PastÃ©is de BelÃ©m', cidade:'Lisboa', tipo:'Docaria', preco:'$', icone:'ðŸ§'}
            ]
        };

        // VARIÃVEIS DE ESTADO
        let isRegisterMode = false;
        let currentUser = null;
        let rawValues = { amountDisplay: 0, salaryInput: 0, calcValueDisplay: 0 };
        let currentRate = 1;

        // FUNÃ‡Ã•ES DE AUTENTICAÃ‡ÃƒO
        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            const fields = document.getElementById('register-fields');
            const title = document.getElementById('auth-title');
            const btnMain = document.getElementById('btn-main-auth');
            const btnSwitch = document.getElementById('btn-switch-auth');

            if (isRegisterMode) {
                fields.classList.remove('hidden');
                title.innerText = 'Nova Conta';
                btnMain.innerText = 'ComeÃ§ar Agora';
                btnSwitch.innerText = 'JÃ¡ tenho uma conta';
                updateSalaryMask();
            } else {
                fields.classList.add('hidden');
                title.innerText = 'iFinance';
                btnMain.innerText = 'Entrar';
                btnSwitch.innerText = 'Criar conta gratuita';
            }
        }

        function updateSalaryMask() {
            const currency = document.getElementById('userCurrencyInput').value;
            document.getElementById('salaryInput').value = format(rawValues.salaryInput, currency);
        }

        function handleAuth() {
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();

            if (isRegisterMode) {
                const name = document.getElementById('userNameInput').value.trim();
                const currency = document.getElementById('userCurrencyInput').value;
                
                if(!email || !pass || !name) {
                    alert("Por favor, preencha todos os campos!");
                    return;
                }

                const userData = {
                    name: name,
                    pass: pass,
                    currency: currency,
                    salary: rawValues.salaryInput,
                    lastMonth: "",
                    transactions: []
                };

                localStorage.setItem(`user_${email}`, JSON.stringify(userData));
                alert("Conta criada com sucesso!");
                toggleAuthMode();
            } else {
                const savedData = localStorage.getItem(`user_${email}`);
                if (savedData) {
                    const user = JSON.parse(savedData);
                    if (user.pass === pass) {
                        currentUser = { ...user, email: email };
                        verificarSalarioMensal();
                        entrarNoApp();
                    } else {
                        alert("Senha incorreta!");
                    }
                } else {
                    alert("UsuÃ¡rio nÃ£o encontrado!");
                }
            }
        }

        function entrarNoApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('displayUserName').innerText = `OlÃ¡, ${currentUser.name}`;
            document.getElementById('displaySalary').innerText = format(currentUser.salary);
            document.getElementById('toCurrency').value = currentUser.currency;
            
            atualizarInterface();
            setGuide('BRL');
            buscarCotacao();
        }

        function verificarSalarioMensal() {
            const dataAtual = new Date();
            const mesReferencia = `${dataAtual.getMonth() + 1}/${dataAtual.getFullYear()}`;
            
            if (currentUser.salary > 0 && currentUser.lastMonth !== mesReferencia) {
                const transacaoSalario = {
                    id: Date.now(),
                    text: "SalÃ¡rio Mensal AutomÃ¡tico ðŸ’°",
                    amount: currentUser.salary,
                    date: dataAtual.toLocaleDateString('pt-BR')
                };
                currentUser.transactions.push(transacaoSalario);
                currentUser.lastMonth = mesReferencia;
                salvarDados();
            }
        }

        // FUNÃ‡Ã•ES DE FORMATAÃ‡ÃƒO E MÃSCARA
        function format(valor, moeda) {
            const m = moeda || (currentUser ? currentUser.currency : 'BRL');
            const locales = {
                'BRL': 'pt-BR', 'USD': 'en-US', 'EUR': 'de-DE', 
                'GBP': 'en-GB', 'JPY': 'ja-JP', 'BTC': 'en-US', 'MXN': 'es-MX'
            };
            
            const casasDecimais = (m === 'BTC') ? 8 : 2;
            
            return valor.toLocaleString(locales[m] || 'pt-BR', {
                style: 'currency',
                currency: m,
                minimumFractionDigits: casasDecimais
            });
        }

        function applyMask(id) {
            const elemento = document.getElementById(id);
            
            elemento.addEventListener('input', (e) => {
                let valorLimpo = e.target.value.replace(/\D/g, '');
                let numero = valorLimpo ? parseFloat(valorLimpo) / 100 : 0;
                
                rawValues[id] = numero;
                
                let moedaParaUsar = null;
                if(id === 'salaryInput') moedaParaUsar = document.getElementById('userCurrencyInput').value;
                if(id === 'calcValueDisplay') moedaParaUsar = document.getElementById('fromCurrency').value;
                
                e.target.value = format(numero, moedaParaUsar);
                
                if (id === 'calcValueDisplay') calcularConversao();
            });
            
            // Valor inicial 0,00
            elemento.value = format(0, id === 'salaryInput' ? 'BRL' : null);
        }

        // Inicializar mÃ¡scaras
        applyMask('amountDisplay');
        applyMask('salaryInput');
        applyMask('calcValueDisplay');

        // FUNÃ‡Ã•ES DA CARTEIRA (HOME)
        function addTransaction() {
            const desc = document.getElementById('desc').value;
            const valorBruto = rawValues.amountDisplay;
            const tipo = document.getElementById('type').value;

            if (!desc || valorBruto === 0) {
                alert("Preencha a descriÃ§Ã£o e o valor!");
                return;
            }

            const valorFinal = (tipo === 'expense') ? -valorBruto : valorBruto;

            const novaTransacao = {
                id: Date.now(),
                text: desc,
                amount: valorFinal,
                date: new Date().toLocaleDateString('pt-BR')
            };

            currentUser.transactions.push(novaTransacao);
            salvarDados();
            atualizarInterface();

            // Limpar campos
            document.getElementById('desc').value = '';
            rawValues.amountDisplay = 0;
            document.getElementById('amountDisplay').value = format(0);
        }

        function atualizarInterface() {
            const lista = document.getElementById('transaction-list');
            lista.innerHTML = '';

            let totalSaldo = 0;
            let totalEntradas = 0;
            let totalSaidas = 0;

            // Processar transaÃ§Ãµes (do mais novo para o mais antigo)
            const transacoesInvertidas = [...currentUser.transactions].reverse();

            transacoesInvertidas.forEach(t => {
                totalSaldo += t.amount;
                if (t.amount > 0) totalEntradas += t.amount;
                else totalSaidas += Math.abs(t.amount);

                const li = document.createElement('li');
                li.className = "flex justify-between items-center py-5 fade-in";
                
                li.innerHTML = `
                    <div>
                        <p class="font-bold text-sm text-slate-700">${t.text}</p>
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">${t.date}</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="${t.amount < 0 ? 'text-red-500' : 'text-emerald-600'} font-black">
                            ${format(t.amount)}
                        </span>
                        <button onclick="deletarTransacao(${t.id})" class="text-slate-200 hover:text-red-400 transition">
                            <i class="fa-solid fa-circle-xmark"></i>
                        </button>
                    </div>
                `;
                lista.appendChild(li);
            });

            document.getElementById('balance').innerText = format(totalSaldo);
            document.getElementById('incomes').innerText = format(totalEntradas);
            document.getElementById('expenses').innerText = format(totalSaidas);
        }

        function deletarTransacao(id) {
            currentUser.transactions = currentUser.transactions.filter(t => t.id !== id);
            salvarDados();
            atualizarInterface();
        }

        function salvarDados() {
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
        }

        function limparTudo() {
            if (confirm("Tem certeza que deseja apagar todo o histÃ³rico?")) {
                currentUser.transactions = [];
                salvarDados();
                atualizarInterface();
            }
        }

        // FUNÃ‡Ã•ES DE CÃ‚MBIO
        async function buscarCotacao() {
            const de = document.getElementById('fromCurrency').value;
            const para = document.getElementById('toCurrency').value;
            const info = document.getElementById('infoCotacao');

            if (de === para) {
                currentRate = 1;
                info.innerText = "1 : 1 (Mesma moeda)";
                calcularConversao();
                return;
            }

            info.innerText = "Buscando cotaÃ§Ã£o em tempo real...";

            try {
                const response = await fetch(`https://economia.awesomeapi.com.br/last/${de}-${para}`);
                const data = await response.json();
                const par = de + para;
                currentRate = parseFloat(data[par].bid);
                
                info.innerText = `1 ${de} = ${currentRate.toFixed(4)} ${para}`;
                calcularConversao();
            } catch (error) {
                info.innerText = "Erro ao carregar cotaÃ§Ã£o.";
            }
        }

        function calcularConversao() {
            const valorBase = rawValues.calcValueDisplay;
            const resultado = valorBase * currentRate;
            const moedaDestino = document.getElementById('toCurrency').value;
            
            document.getElementById('calcResultDisplay').innerText = format(resultado, moedaDestino);
        }

        function lancarCambio() {
            const valorConvertido = rawValues.calcValueDisplay * currentRate;
            const moedaOrigem = document.getElementById('fromCurrency').value;

            if (valorConvertido <= 0) {
                alert("Insira um valor para converter!");
                return;
            }

            const novaTransacao = {
                id: Date.now(),
                text: `CÃ¢mbio: ${moedaOrigem} para ${currentUser.currency}`,
                amount: -valorConvertido, // LanÃ§ado como saÃ­da do saldo principal
                date: new Date().toLocaleDateString('pt-BR')
            };

            currentUser.transactions.push(novaTransacao);
            salvarDados();
            atualizarInterface();
            switchTab('home');
            alert("Valor lanÃ§ado como dÃ©bito na sua carteira!");
        }

        // GUIA DE VIAGEM
        function setGuide(pais) {
            const container = document.getElementById('restaurant-list');
            container.innerHTML = '';

            const lista = restaurantesDB[pais] || restaurantesDB['BRL'];

            lista.forEach(res => {
                const card = document.createElement('div');
                card.className = "bg-white p-5 rounded-3xl border shadow-sm text-left flex items-center gap-4 fade-in";
                
                card.innerHTML = `
                    <div class="text-3xl bg-slate-50 w-14 h-14 flex items-center justify-center rounded-2xl">
                        ${res.icone}
                    </div>
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-800 text-sm">${res.nome}</h4>
                        <p class="text-[9px] text-blue-500 font-bold uppercase tracking-wider">${res.cidade} â€¢ ${res.tipo}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-emerald-500 font-black text-xs">${res.preco}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // NAVEGAÃ‡ÃƒO ENTRE ABAS
        function switchTab(nomeAba) {
            // Esconder todas
            const abas = ['home', 'cambio', 'viagem'];
            abas.forEach(aba => {
                document.getElementById('tab-' + aba).classList.add('hidden');
                document.getElementById('nav-' + aba).classList.remove('tab-active');
                document.getElementById('nav-' + aba).classList.add('text-slate-400');
            });

            // Mostrar a selecionada
            document.getElementById('tab-' + nomeAba).classList.remove('hidden');
            const navBtn = document.getElementById('nav-' + nomeAba);
            navBtn.classList.add('tab-active');
            navBtn.classList.remove('text-slate-400');
        }

        function logout() {
            if(confirm("Deseja sair da conta?")) {
                location.reload();
            }
        }
    </script>
</body>
</html>
