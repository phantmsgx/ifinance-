<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iFinance Premium</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none !important; }
        .tab-active { color: #2563eb; transform: scale(1.1); }
        * { user-select: none; }
        input { user-select: auto; }
        .bg-auth { background: radial-gradient(circle at top right, #eff6ff, #ffffff); }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <section id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-auth text-center">
        <div class="mb-6 w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center shadow-xl text-white text-4xl">
            <i class="fa-solid fa-wallet"></i>
        </div>
        <h1 id="auth-title" class="text-4xl font-black mb-2">i<span class="text-blue-600">Finance</span></h1>
        <p id="auth-subtitle" class="text-slate-500 mb-8 font-medium">Sua jornada financeira comeÃ§a aqui.</p>

        <div class="flex flex-col w-full max-w-sm gap-4">
            <input type="email" id="emailInput" placeholder="E-mail" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
            <input type="password" id="passInput" placeholder="Senha" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
            
            <div id="register-fields" class="hidden flex flex-col gap-4 animate-in fade-in slide-in-from-bottom-4">
                <input type="text" id="userNameInput" placeholder="Como quer ser chamado?" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
                
                <div class="bg-blue-50 p-5 rounded-2xl border border-blue-100 text-left">
                    <p class="text-[10px] font-black text-blue-600 uppercase mb-2 tracking-widest">ConfiguraÃ§Ã£o de Renda</p>
                    <input type="text" id="salaryInput" placeholder="0,00" class="w-full bg-transparent border-b border-blue-200 py-2 font-bold text-xl outline-none mb-2">
                    <p class="text-[10px] text-blue-400 leading-tight">
                        <i class="fa-solid fa-circle-info mr-1"></i> 
                        O salÃ¡rio serve para o app lanÃ§ar seu saldo automaticamente todo mÃªs.
                    </p>
                </div>

                <select id="userCurrencyInput" class="bg-white border p-5 rounded-2xl font-bold text-lg outline-none shadow-sm">
                    <option value="">Moeda Principal</option>
                    <option value="BRL">R$ - Real Brasileiro</option>
                    <option value="USD">$ - DÃ³lar Americano</option>
                    <option value="EUR">â‚¬ - Euro</option>
                    <option value="GBP">Â£ - Libra Esterlina</option>
                </select>
            </div>

            <button onclick="handleAuth()" id="btn-main-auth" class="bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg shadow-lg active:scale-95 transition">Entrar</button>
            <button onclick="toggleAuthMode()" id="btn-switch-auth" class="text-blue-600 font-bold mt-2">Criar conta gratuita</button>
        </div>
    </section>

    <div id="main-app" class="hidden">
        <section id="tab-home">
            <header class="bg-white border-b p-4 sticky top-0 z-10 flex justify-between items-center px-8">
                <h1 class="text-xl font-extrabold text-blue-600 italic">iFinance</h1>
                <div class="flex items-center gap-4">
                    <span id="displayUserName" class="text-slate-500 font-bold text-sm"></span>
                    <button onclick="logout()"><i class="fa-solid fa-right-from-bracket text-slate-300"></i></button>
                </div>
            </header>
            
            <main class="p-6 max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-center">
                    <div class="bg-white p-6 rounded-2xl border-2 border-blue-50 shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-tighter">Saldo DisponÃ­vel</p>
                        <h2 class="text-3xl font-black" id="balance">0,00</h2>
                        <div class="mt-2 inline-flex items-center px-3 py-1 bg-blue-100 rounded-full">
                            <span class="text-[9px] font-black text-blue-600">RENDA: <span id="displaySalary">0,00</span></span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-green-500 uppercase tracking-tighter">Entradas</p>
                        <h2 class="text-3xl font-black text-green-600" id="incomes">0,00</h2>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-red-500 uppercase tracking-tighter">SaÃ­das</p>
                        <h2 class="text-3xl font-black text-red-600" id="expenses">0,00</h2>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl border mb-10 grid grid-cols-1 md:grid-cols-4 gap-4 shadow-sm">
                    <input type="text" id="desc" placeholder="O que vocÃª comprou?" class="bg-slate-50 p-4 rounded-2xl border-none outline-blue-500 font-medium">
                    <input type="text" id="amountDisplay" placeholder="0,00" class="bg-slate-50 p-4 rounded-2xl border-none font-bold text-lg outline-blue-500 text-center">
                    <select id="type" class="bg-slate-50 p-4 rounded-2xl border-none font-bold">
                        <option value="expense">Gastei (SaÃ­da)</option>
                        <option value="income">Recebi (Entrada)</option>
                    </select>
                    <button onclick="addTransaction()" class="bg-blue-600 text-white font-bold rounded-2xl py-4 shadow-lg active:scale-95 transition">Salvar</button>
                </div>

                <div class="bg-white p-6 rounded-3xl border shadow-sm">
                    <h3 class="font-black text-slate-400 text-[10px] uppercase tracking-widest mb-4 px-2">HistÃ³rico Mensal</h3>
                    <ul id="transaction-list" class="divide-y divide-slate-50"></ul>
                    <button onclick="limparTudo()" class="w-full text-center py-4 text-[10px] text-red-300 font-bold uppercase tracking-widest mt-4">Zerar Tudo</button>
                </div>
            </main>
        </section>

        <section id="tab-cambio" class="hidden p-6">
             <div class="max-w-md mx-auto bg-white p-8 rounded-[40px] border shadow-sm space-y-6 mt-4">
                <div class="flex items-center justify-between gap-4">
                    <select id="fromCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="USD">ðŸ‡ºðŸ‡¸ USD</option><option value="EUR">ðŸ‡ªðŸ‡º EUR</option><option value="BRL">ðŸ‡§ðŸ‡· BRL</option><option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                    </select>
                    <i class="fa-solid fa-repeat text-blue-500"></i>
                    <select id="toCurrency" onchange="buscarCotacao()" class="w-full bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="BRL">ðŸ‡§ðŸ‡· BRL</option><option value="USD">ðŸ‡ºðŸ‡¸ USD</option><option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                    </select>
                </div>
                <input type="text" id="calcValueDisplay" placeholder="0,00" class="w-full bg-slate-50 p-6 rounded-2xl font-bold text-3xl border-none text-center outline-none">
                <div class="text-center py-2"><span id="infoCotacao" class="text-blue-500 font-bold bg-blue-50 px-4 py-2 rounded-full text-[10px]">Carregando...</span></div>
                <div class="bg-blue-600 p-8 rounded-[32px] text-center shadow-xl">
                    <p class="text-blue-200 text-[10px] font-black mb-1 uppercase tracking-widest">Convertido</p>
                    <h3 class="text-4xl font-black text-white" id="calcResultDisplay">0,00</h3>
                </div>
                <button onclick="lancarCambio()" class="w-full bg-slate-900 text-white font-black p-5 rounded-2xl shadow-lg active:scale-95 transition text-xs uppercase tracking-widest">LanÃ§ar no Saldo</button>
             </div>
        </section>

        <section id="tab-viagem" class="hidden p-6 text-center">
            <h2 class="text-2xl font-black mb-6 mt-4">Guia de Restaurantes</h2>
            <div class="flex gap-2 overflow-x-auto pb-4 mb-4 no-scrollbar">
                <button onclick="setGuide('BRL')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm">ðŸ‡§ðŸ‡· Brasil</button>
                <button onclick="setGuide('USD')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm">ðŸ‡ºðŸ‡¸ EUA</button>
                <button onclick="setGuide('EUR')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm">ðŸ‡ªðŸ‡º Europa</button>
                <button onclick="setGuide('GBP')" class="bg-white border px-6 py-3 rounded-full font-bold shadow-sm">ðŸ‡¬ðŸ‡§ UK</button>
            </div>
            <div id="restaurant-list" class="space-y-4 pb-24"></div>
        </section>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t py-4 flex justify-around shadow-2xl z-50">
            <button onclick="switchTab('home')" id="nav-home" class="flex flex-col items-center tab-active">
                <i class="fa-solid fa-wallet text-xl"></i><span class="text-[9px] font-black mt-1">CARTEIRA</span>
            </button>
            <button onclick="switchTab('cambio')" id="nav-cambio" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-money-bill-transfer text-xl"></i><span class="text-[9px] font-black mt-1">CÃ‚MBIO</span>
            </button>
            <button onclick="switchTab('viagem')" id="nav-viagem" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-utensils text-xl"></i><span class="text-[9px] font-black mt-1">GUIA</span>
            </button>
        </nav>
    </div>

    <script>
        const restaurantesDB = {
            'BRL': [{nome:'A Casa do Porco', cidade:'SP', tipo:'Brasileira', preco:'$$$', icone:'ðŸ·'}, {nome:'Marius Degustare', cidade:'RJ', tipo:'Churrasco', preco:'$$$$', icone:'ðŸ¥©'}, {nome:'D.O.M', cidade:'SP', tipo:'Fina', preco:'$$$$$', icone:'ðŸŒ¿'}, {nome:'ManÃ­', cidade:'SP', tipo:'Moderna', preco:'$$$$', icone:'ðŸ¥£'}, {nome:'Glouton', cidade:'BH', tipo:'Mineira', preco:'$$$', icone:'ðŸ·'}],
            'USD': [{nome:'Joe\'s Pizza', cidade:'NY', tipo:'Pizza', preco:'$', icone:'ðŸ•'}, {nome:'Katz\'s Deli', cidade:'NY', tipo:'SanduÃ­che', preco:'$$', icone:'ðŸ¥ª'}, {nome:'Le Bernardin', cidade:'NY', tipo:'Peixe', preco:'$$$$$', icone:'ðŸŸ'}, {nome:'Nobu Malibu', cidade:'LA', tipo:'JaponÃªs', preco:'$$$$', icone:'ðŸ£'}, {nome:'French Laundry', cidade:'Napa', tipo:'FrancÃªs', preco:'$$$$$', icone:'ðŸ°'}],
            'EUR': [{nome:'Le Meurice', cidade:'Paris', tipo:'Luxo', preco:'$$$$$', icone:'ðŸ¥'}, {nome:'Trattoria Baffetto', cidade:'Roma', tipo:'Pizza', preco:'$$', icone:'ðŸ‡®ðŸ‡¹'}, {nome:'Osteria Francescana', cidade:'Modena', tipo:'Criativa', preco:'$$$$$', icone:'ðŸŽ¨'}, {nome:'HofbrÃ¤uhaus', cidade:'Munique', tipo:'AlemÃ£', preco:'$$', icone:'ðŸº'}, {nome:'BotÃ­n', cidade:'Madrid', tipo:'Assados', preco:'$$$', icone:'ðŸ–'}],
            'GBP': [{nome:'Dishoom', cidade:'Londres', tipo:'Indiana', preco:'$$', icone:'ðŸ›'}, {nome:'Sketch', cidade:'Londres', tipo:'ChÃ¡', preco:'$$$$', icone:'ðŸ«–'}, {nome:'Fat Duck', cidade:'Bray', tipo:'Molecular', preco:'$$$$$', icone:'ðŸ§ª'}, {nome:'Rules', cidade:'Londres', tipo:'BritÃ¢nica', preco:'$$$', icone:'ðŸ’‚'}, {nome:'St. John', cidade:'Londres', tipo:'Carnes', preco:'$$$', icone:'ðŸ–'}]
        };

        let isRegisterMode = false, currentUser = null;
        let rawValues = { amountDisplay: 0, salaryInput: 0, calcValueDisplay: 0 };
        let currentRate = 1;

        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('register-fields').classList.toggle('hidden');
            document.getElementById('auth-title').innerText = isRegisterMode ? 'Nova Conta' : 'iFinance';
            document.getElementById('btn-main-auth').innerText = isRegisterMode ? 'ComeÃ§ar Agora' : 'Entrar';
            document.getElementById('btn-switch-auth').innerText = isRegisterMode ? 'JÃ¡ sou membro' : 'Criar conta gratuita';
        }

        function handleAuth() {
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();
            if (isRegisterMode) {
                const name = document.getElementById('userNameInput').value.trim();
                const currency = document.getElementById('userCurrencyInput').value;
                if(!email || !pass || !name || !currency) return alert("Preencha todos os dados!");
                const userData = { name, pass, currency, salary: rawValues.salaryInput, lastMonth: "", transactions: [] };
                localStorage.setItem(`user_${email}`, JSON.stringify(userData));
                alert("Conta criada!"); toggleAuthMode();
            } else {
                const saved = localStorage.getItem(`user_${email}`);
                if (saved) {
                    const user = JSON.parse(saved);
                    if (user.pass === pass) {
                        currentUser = { ...user, email };
                        verificarSalario();
                        startApp();
                    } else { alert("Senha incorreta."); }
                } else { alert("UsuÃ¡rio nÃ£o encontrado."); }
            }
        }

        function verificarSalario() {
            const agora = new Date();
            const mesRef = `${agora.getMonth() + 1}/${agora.getFullYear()}`;
            if (currentUser.salary > 0 && currentUser.lastMonth !== mesRef) {
                currentUser.transactions.push({ id: Date.now(), text: "SalÃ¡rio Mensal ðŸ’°", amount: currentUser.salary, date: agora.toLocaleDateString() });
                currentUser.lastMonth = mesRef;
                save();
            }
        }

        function startApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('displayUserName').innerText = `OlÃ¡, ${currentUser.name}`;
            document.getElementById('displaySalary').innerText = format(currentUser.salary);
            document.getElementById('toCurrency').value = currentUser.currency;
            render(); setGuide(currentUser.currency); buscarCotacao();
        }

        function logout() { location.reload(); }
        function save() { localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser)); }

        function format(val, curr) {
            const c = curr || (currentUser ? currentUser.currency : 'BRL');
            const loc = {'BRL':'pt-BR','USD':'en-US','EUR':'de-DE','GBP':'en-GB'};
            return val.toLocaleString(loc[c] || 'pt-BR', { style:'currency', currency: c, minimumFractionDigits: 2 });
        }

        function applyMask(id) {
            document.getElementById(id).addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, '');
                let num = v ? parseFloat(v) / 100 : 0;
                rawValues[id] = num;
                e.target.value = format(num, id === 'calcValueDisplay' ? document.getElementById('fromCurrency').value : null);
                if (id === 'calcValueDisplay') atualizarResultado();
            });
            // Valor inicial
            document.getElementById(id).value = format(0, id === 'calcValueDisplay' ? document.getElementById('fromCurrency').value : null);
        }

        ['amountDisplay', 'salaryInput', 'calcValueDisplay'].forEach(applyMask);

        function addTransaction() {
            const desc = document.getElementById('desc').value;
            const amtRaw = rawValues.amountDisplay;
            if(!desc || amtRaw === 0) return alert("Preencha descriÃ§Ã£o e valor!");
            const amt = document.getElementById('type').value === 'expense' ? -amtRaw : amtRaw;
            currentUser.transactions.push({ id: Date.now(), text: desc, amount: amt, date: new Date().toLocaleDateString() });
            save(); render();
            document.getElementById('desc').value = '';
            rawValues.amountDisplay = 0;
            document.getElementById('amountDisplay').value = format(0);
        }

        function render() {
            const amts = currentUser.transactions.map(t => t.amount);
            const total = amts.reduce((a, b) => a + b, 0);
            const inc = amts.filter(v => v > 0).reduce((a, b) => a + b, 0);
            const exp = amts.filter(v => v < 0).reduce((a, b) => a + b, 0);
            document.getElementById('balance').innerText = format(total);
            document.getElementById('incomes').innerText = format(inc);
            document.getElementById('expenses').innerText = format(Math.abs(exp));
            const list = document.getElementById('transaction-list');
            list.innerHTML = '';
            [...currentUser.transactions].reverse().forEach(t => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center py-5";
                li.innerHTML = `<div><p class="font-bold text-sm text-slate-700">${t.text}</p><p class="text-[9px] text-slate-400 font-bold uppercase">${t.date}</p></div><div class="flex items-center gap-4"><span class="${t.amount < 0 ? 'text-red-500':'text-emerald-600'} font-black">${format(t.amount)}</span><button onclick="del(${t.id})" class="text-slate-200"><i class="fa-solid fa-circle-xmark"></i></button></div>`;
                list.appendChild(li);
            });
        }

        function del(id) { currentUser.transactions = currentUser.transactions.filter(t => t.id !== id); save(); render(); }
        function limparTudo() { if(confirm("Zerar histÃ³rico?")) { currentUser.transactions = []; save(); render(); } }

        async function buscarCotacao() {
            const f = document.getElementById('fromCurrency').value, t = document.getElementById('toCurrency').value;
            if(f === t) { currentRate = 1; document.getElementById('infoCotacao').innerText = "1:1"; atualizarResultado(); return; }
            try {
                const r = await fetch(`https://economia.awesomeapi.com.br/last/${f}-${t}`);
                const d = await r.json();
                currentRate = parseFloat(d[f+t].bid);
                document.getElementById('infoCotacao').innerText = `1 ${f} = ${currentRate.toFixed(2)} ${t}`;
                atualizarResultado();
            } catch(e) { document.getElementById('infoCotacao').innerText = "Erro cotaÃ§Ã£o"; }
        }

        function atualizarResultado() {
            const res = rawValues.calcValueDisplay * currentRate;
            document.getElementById('calcResultDisplay').innerText = format(res, document.getElementById('toCurrency').value);
        }

        function lancarCambio() {
            const res = rawValues.calcValueDisplay * currentRate; if(res === 0) return;
            currentUser.transactions.push({ id: Date.now(), text: `CÃ¢mbio ${document.getElementById('fromCurrency').value}`, amount: -res, date: new Date().toLocaleDateString() });
            save(); rawValues.calcValueDisplay = 0; document.getElementById('calcValueDisplay').value = format(0, document.getElementById('fromCurrency').value); render(); switchTab('home');
        }

        function setGuide(dest) {
            const data = restaurantesDB[dest] || restaurantesDB['USD'];
            document.getElementById('restaurant-list').innerHTML = data.map(res => `
                <div class="bg-white p-5 rounded-3xl border shadow-sm text-left flex items-center gap-4">
                    <div class="text-2xl">${res.icone}</div>
                    <div class="flex-1"><h4 class="font-bold text-slate-800 text-sm">${res.nome}</h4><p class="text-[9px] text-blue-500 font-bold uppercase">${res.cidade} â€¢ ${res.tipo}</p></div>
                    <span class="text-emerald-500 font-black text-xs">${res.preco}</span>
                </div>
            `).join('');
        }

        function switchTab(t) {
            ['home', 'cambio', 'viagem'].forEach(tab => {
                document.getElementById('tab-' + tab).classList.add('hidden');
                document.getElementById('nav-' + tab).classList.replace('tab-active', 'text-slate-400');
            });
            document.getElementById('tab-' + t).classList.remove('hidden');
            document.getElementById('nav-' + t).classList.add('tab-active');
            document.getElementById('nav-' + t).classList.remove('text-slate-400');
        }
    </script>
</body>
</html>
