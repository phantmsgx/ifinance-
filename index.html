<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iFinance Premium</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        .hidden { display: none !important; }
        .tab-active { color: #2563eb; transform: scale(1.1); }
        * { user-select: none; }
        input { user-select: auto; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <section id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-6 bg-white text-center">
        <div class="mb-6 w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center shadow-xl text-white text-4xl">
            <i class="fa-solid fa-wallet"></i>
        </div>
        <h1 id="auth-title" class="text-4xl font-black mb-2">i<span class="text-blue-600">Finance</span></h1>
        <p id="auth-subtitle" class="text-slate-500 mb-8">FaÃ§a login para gerenciar suas finanÃ§as</p>

        <div class="flex flex-col w-full max-w-sm gap-4">
            <input type="email" id="emailInput" placeholder="E-mail" class="bg-slate-50 border p-5 rounded-2xl font-bold text-lg">
            <input type="password" id="passInput" placeholder="Senha" class="bg-slate-50 border p-5 rounded-2xl font-bold text-lg">
            
            <div id="register-fields" class="hidden flex flex-col gap-4">
                <input type="text" id="userNameInput" placeholder="Seu nome" class="bg-slate-50 border p-5 rounded-2xl font-bold text-lg">
                <select id="userCurrencyInput" class="bg-slate-50 border p-5 rounded-2xl font-bold text-lg">
                    <option value="">Selecione sua Moeda</option>
                    <option value="BRL">R$ - Real Brasileiro</option>
                    <option value="USD">$ - DÃ³lar Americano</option>
                    <option value="EUR">â‚¬ - Euro</option>
                    <option value="GBP">Â£ - Libra Esterlina</option>
                    <option value="JPY">Â¥ - Iene JaponÃªs</option>
                    <option value="CAD">C$ - DÃ³lar Canadense</option>
                    <option value="CHF">Fr - Franco SuÃ­Ã§o</option>
                    <option value="AUD">A$ - DÃ³lar Australiano</option>
                    <option value="CNY">Â¥ - Yuan ChinÃªs</option>
                    <option value="BTC">â‚¿ - Bitcoin</option>
                </select>
            </div>

            <button onclick="handleAuth()" id="btn-main-auth" class="bg-blue-600 text-white py-5 rounded-2xl font-bold text-lg shadow-lg">Entrar</button>
            <button onclick="toggleAuthMode()" id="btn-switch-auth" class="text-blue-600 font-bold mt-2">Criar nova conta</button>
        </div>
    </section>

    <div id="main-app" class="hidden">
        <section id="tab-home">
            <header class="bg-white border-b p-4 sticky top-0 z-10 flex justify-between items-center px-8">
                <h1 class="text-xl font-extrabold text-blue-600 italic">iFinance</h1>
                <div class="flex items-center gap-4">
                    <span id="displayUserName" class="text-slate-500 font-bold"></span>
                    <button onclick="logout()"><i class="fa-solid fa-right-from-bracket text-slate-400"></i></button>
                </div>
            </header>
            
            <main class="p-6 max-w-4xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-center">
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-slate-400 uppercase">Saldo Total</p>
                        <h2 class="text-3xl font-black" id="balance">0,00</h2>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-green-500 uppercase">Entradas</p>
                        <h2 class="text-3xl font-black text-green-600" id="incomes">0,00</h2>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border shadow-sm">
                        <p class="text-xs font-bold text-red-500 uppercase">SaÃ­das</p>
                        <h2 class="text-3xl font-black text-red-600" id="expenses">0,00</h2>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl border mb-10 grid grid-cols-1 md:grid-cols-4 gap-4 shadow-sm">
                    <input type="text" id="desc" placeholder="DescriÃ§Ã£o" class="bg-slate-50 p-4 rounded-2xl border-none outline-blue-500">
                    <input type="text" id="amountDisplay" placeholder="0,00" class="bg-slate-50 p-4 rounded-2xl border-none font-bold text-lg outline-blue-500">
                    <select id="type" class="bg-slate-50 p-4 rounded-2xl border-none font-bold">
                        <option value="income">Entrada</option>
                        <option value="expense">SaÃ­da</option>
                    </select>
                    <button onclick="addTransaction()" class="bg-blue-600 text-white font-bold rounded-2xl py-4">Salvar</button>
                </div>

                <div class="bg-white p-6 rounded-3xl border shadow-sm">
                    <div class="flex justify-between mb-4 items-center">
                        <h3 class="font-bold">HistÃ³rico</h3>
                        <button onclick="limparTudo()" class="text-[10px] text-red-400 font-bold border border-red-100 px-3 py-1 rounded-full">LIMPAR TUDO</button>
                    </div>
                    <ul id="transaction-list"></ul>
                </div>
            </main>
        </section>

        <section id="tab-cambio" class="hidden p-6 max-w-2xl mx-auto">
            <div class="text-center mb-8"><h2 class="text-3xl font-black">CÃ¢mbio Realtime</h2></div>
            <div class="bg-white p-8 rounded-[32px] border space-y-6 shadow-sm">
                <div class="grid grid-cols-2 gap-4">
                    <select id="fromCurrency" onchange="buscarCotacao()" class="bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                        <option value="EUR">ğŸ‡ªğŸ‡º EUR</option>
                        <option value="BRL">ğŸ‡§ğŸ‡· BRL</option>
                        <option value="GBP">ğŸ‡¬ğŸ‡§ GBP</option>
                    </select>
                    <select id="toCurrency" onchange="buscarCotacao()" class="bg-slate-50 p-4 rounded-2xl font-bold border-none outline-none">
                        <option value="BRL">ğŸ‡§ğŸ‡· BRL</option>
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                        <option value="EUR">ğŸ‡ªğŸ‡º EUR</option>
                    </select>
                </div>
                <input type="text" id="calcValueDisplay" placeholder="0,00" class="w-full bg-slate-50 p-5 rounded-2xl font-bold text-2xl border-none outline-none text-center">
                <p id="infoCotacao" class="text-center text-blue-500 font-bold italic">Buscando cotaÃ§Ã£o...</p>
                <div class="bg-slate-900 p-8 rounded-3xl text-center shadow-lg">
                    <p class="text-slate-400 text-[10px] font-bold mb-2 uppercase tracking-widest">Total Convertido</p>
                    <h3 class="text-4xl font-black text-white" id="calcResultDisplay">0,00</h3>
                </div>
                <button onclick="lancarCambio()" class="w-full bg-blue-600 text-white font-extrabold p-5 rounded-2xl shadow-lg">LanÃ§ar no HistÃ³rico</button>
            </div>
        </section>

        <section id="tab-viagem" class="hidden p-6 max-w-2xl mx-auto text-center">
            <h2 class="text-3xl font-black mb-4">Guia GastronÃ´mico</h2>
            <select id="guideDestination" onchange="renderRestaurantes()" class="w-full p-4 rounded-2xl border-none bg-white shadow-sm font-bold mb-8 outline-none text-center">
                <option value="BRL">ğŸ‡§ğŸ‡· Brasil</option>
                <option value="USD">ğŸ‡ºğŸ‡¸ EUA</option>
                <option value="EUR">ğŸ‡ªğŸ‡º Europa</option>
                <option value="GBP">ğŸ‡¬ğŸ‡§ Reino Unido</option>
            </select>
            <div id="restaurant-list" class="space-y-6 pb-20"></div>
        </section>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t py-4 flex justify-around shadow-2xl z-50">
            <button onclick="switchTab('home')" id="nav-home" class="flex flex-col items-center tab-active">
                <i class="fa-solid fa-house"></i>
                <span class="text-[10px] font-bold mt-1">INÃCIO</span>
            </button>
            <button onclick="switchTab('cambio')" id="nav-cambio" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-coins"></i>
                <span class="text-[10px] font-bold mt-1">CÃ‚MBIO</span>
            </button>
            <button onclick="switchTab('viagem')" id="nav-viagem" class="flex flex-col items-center text-slate-400">
                <i class="fa-solid fa-utensils"></i>
                <span class="text-[10px] font-bold mt-1">GUIA</span>
            </button>
        </nav>
    </div>

    <script>
        const restaurantesDB = {
            'BRL': [{nome:'A Casa do Porco', cidade:'SP', endereco:'R. AraÃºjo, 124', tipo:'Brasileira', preco:'$$$', icone:'ğŸ·'}, {nome:'Marius Degustare', cidade:'RJ', endereco:'Av. AtlÃ¢ntica, 290', tipo:'Churrasco', preco:'$$$$', icone:'ğŸ¥©'}],
            'USD': [{nome:'Joe\'s Pizza', cidade:'NY', endereco:'7 Carmine St', tipo:'Pizzaria', preco:'$', icone:'ğŸ•'}, {nome:'Katz\'s Deli', cidade:'NY', endereco:'205 E Houston St', tipo:'SanduÃ­che', preco:'$$', icone:'ğŸ¥ª'}],
            'EUR': [{nome:'Le Meurice', cidade:'Paris', endereco:'228 Rue de Rivoli', tipo:'Luxo', preco:'$$$$$', icone:'ğŸ¥'}, {nome:'Trattoria Baffetto', cidade:'Roma', endereco:'Via Governo Vecchio 114', tipo:'Pizza', preco:'$$', icone:'ğŸ‡®ğŸ‡¹'}],
            'GBP': [{nome:'Dishoom', cidade:'Londres', endereco:'12 Upper St Martins', tipo:'Indiana', preco:'$$', icone:'ğŸ›'}, {nome:'Sketch', cidade:'Londres', endereco:'9 Conduit St', tipo:'ChÃ¡', preco:'$$$$', icone:'ğŸ«–'}]
        };

        let isRegisterMode = false;
        let currentUser = null;
        let rawValue = 0;
        let rawCalcValue = 0;
        let currentRate = 1;

        // AUTH FUNCTIONS
        function toggleAuthMode() {
            isRegisterMode = !isRegisterMode;
            document.getElementById('register-fields').classList.toggle('hidden');
            document.getElementById('auth-title').innerText = isRegisterMode ? 'Criar Conta' : 'iFinance';
            document.getElementById('btn-main-auth').innerText = isRegisterMode ? 'Cadastrar' : 'Entrar';
            document.getElementById('btn-switch-auth').innerText = isRegisterMode ? 'JÃ¡ tenho login' : 'Criar nova conta';
        }

        function handleAuth() {
            const email = document.getElementById('emailInput').value.trim();
            const pass = document.getElementById('passInput').value.trim();

            if (isRegisterMode) {
                const name = document.getElementById('userNameInput').value.trim();
                const currency = document.getElementById('userCurrencyInput').value;
                if(!email || !pass || !name || !currency) return alert("Preencha todos os campos!");
                
                const userData = { name, pass, currency, transactions: [] };
                localStorage.setItem(`user_${email}`, JSON.stringify(userData));
                alert("Conta criada com sucesso! FaÃ§a login.");
                toggleAuthMode();
            } else {
                const savedData = localStorage.getItem(`user_${email}`);
                if (savedData) {
                    const user = JSON.parse(savedData);
                    if (user.pass === pass) {
                        currentUser = { ...user, email };
                        startApp();
                    } else { alert("Senha incorreta!"); }
                } else { alert("UsuÃ¡rio nÃ£o encontrado!"); }
            }
        }

        function startApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('displayUserName').innerText = `OlÃ¡, ${currentUser.name}!`;
            document.getElementById('toCurrency').value = currentUser.currency;
            document.getElementById('guideDestination').value = ['BRL','USD','EUR','GBP'].includes(currentUser.currency) ? currentUser.currency : 'USD';
            render();
            renderRestaurantes();
            buscarCotacao();
        }

        function logout() { location.reload(); }

        // FINANCE FUNCTIONS
        function formatValue(value, customCurrency) {
            const currency = customCurrency || currentUser.currency || 'BRL';
            const locales = {'BRL':'pt-BR','USD':'en-US','EUR':'de-DE','GBP':'en-GB','JPY':'ja-JP','CAD':'en-CA','CHF':'fr-CH','AUD':'en-AU','CNY':'zh-CN','BTC':'en-US'};
            return value.toLocaleString(locales[currency] || 'pt-BR', {style:'currency', currency: currency});
        }

        document.getElementById('amountDisplay').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if(!value) { rawValue = 0; e.target.value = ''; return; }
            rawValue = parseFloat(value) / 100;
            e.target.value = formatValue(rawValue);
        });

        function addTransaction() {
            const desc = document.getElementById('desc').value;
            if(!desc || rawValue === 0) return alert('Preencha os campos!');
            const amount = document.getElementById('type').value === 'expense' ? -rawValue : rawValue;
            
            currentUser.transactions.push({id: Date.now(), text: desc, amount, date: new Date().toLocaleDateString()});
            saveAndRender();
            document.getElementById('desc').value = '';
            document.getElementById('amountDisplay').value = '';
            rawValue = 0;
        }

        function saveAndRender() {
            localStorage.setItem(`user_${currentUser.email}`, JSON.stringify(currentUser));
            render();
        }

        function render() {
            const list = document.getElementById('transaction-list');
            const amounts = currentUser.transactions.map(t => t.amount);
            const total = amounts.reduce((acc, v) => acc + v, 0);
            const inc = amounts.filter(v => v > 0).reduce((acc, v) => acc + v, 0);
            const exp = amounts.filter(v => v < 0).reduce((acc, v) => acc + v, 0) * -1;

            document.getElementById('balance').innerText = formatValue(total);
            document.getElementById('incomes').innerText = formatValue(inc);
            document.getElementById('expenses').innerText = formatValue(exp);

            list.innerHTML = currentUser.transactions.length === 0 ? '<p class="text-slate-300 py-4 text-center">Nenhum lanÃ§amento</p>' : '';
            [...currentUser.transactions].reverse().forEach(t => {
                const li = document.createElement('li');
                li.className = "flex justify-between items-center py-4 border-b animate-in fade-in";
                li.innerHTML = `<div><p class="font-bold text-sm">${t.text}</p><p class="text-[10px] text-slate-400">${t.date}</p></div><div class="flex items-center gap-4"><span class="${t.amount < 0 ? 'text-red-500':'text-green-600'} font-black">${formatValue(t.amount)}</span><button onclick="removeTransaction(${t.id})"><i class="fa-solid fa-trash-can text-slate-200"></i></button></div>`;
                list.appendChild(li);
            });
        }

        function removeTransaction(id) {
            currentUser.transactions = currentUser.transactions.filter(t => t.id !== id);
            saveAndRender();
        }

        function limparTudo() { if(confirm("Deseja apagar todo o histÃ³rico?")) { currentUser.transactions = []; saveAndRender(); } }

        // CAMBIO FUNCTIONS
        document.getElementById('calcValueDisplay').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if(!value) { rawCalcValue = 0; e.target.value = ''; atualizarResultado(); return; }
            rawCalcValue = parseFloat(value) / 100;
            e.target.value = formatValue(rawCalcValue, document.getElementById('fromCurrency').value);
            atualizarResultado();
        });

        async function buscarCotacao() {
            const from = document.getElementById('fromCurrency').value;
            const to = document.getElementById('toCurrency').value;
            if(from === to) { currentRate = 1; document.getElementById('infoCotacao').innerText = "1:1"; atualizarResultado(); return; }
            try {
                const r = await fetch(`https://economia.awesomeapi.com.br/last/${from}-${to}`);
                const d = await r.json();
                currentRate = parseFloat(d[from+to].bid);
                document.getElementById('infoCotacao').innerText = `1 ${from} = ${currentRate.toFixed(2)} ${to}`;
                atualizarResultado();
            } catch(e) { document.getElementById('infoCotacao').innerText = "CotaÃ§Ã£o indisponÃ­vel"; }
        }

        function atualizarResultado() {
            const res = rawCalcValue * currentRate;
            document.getElementById('calcResultDisplay').innerText = formatValue(res, document.getElementById('toCurrency').value);
        }

        function lancarCambio() {
            const res = rawCalcValue * currentRate;
            if(res === 0) return;
            const from = document.getElementById('fromCurrency').value;
            currentUser.transactions.push({id: Date.now(), text: `CÃ¢mbio ${from}`, amount: -res, date: new Date().toLocaleDateString()});
            saveAndRender();
            rawCalcValue = 0; document.getElementById('calcValueDisplay').value = ''; atualizarResultado();
            switchTab('home');
        }

        // GUI FUNCTIONS
        function renderRestaurantes() {
            const dest = document.getElementById('guideDestination').value;
            const data = restaurantesDB[dest] || [];
            document.getElementById('restaurant-list').innerHTML = data.map(res => `
                <div class="bg-white p-6 rounded-3xl border shadow-sm text-left">
                    <div class="flex items-center gap-4">
                        <div class="text-3xl">${res.icone}</div>
                        <div class="flex-1"><h4 class="font-bold">${res.nome}</h4><p class="text-xs text-blue-600">${res.cidade}</p></div>
                        <span class="text-emerald-600 font-bold">${res.preco}</span>
                    </div>
                    <button class="w-full bg-slate-50 py-3 rounded-xl text-[10px] font-black mt-4 uppercase tracking-tighter">Ver localizaÃ§Ã£o</button>
                </div>
            `).join('');
        }

        function switchTab(tab) {
            ['home', 'cambio', 'viagem'].forEach(t => {
                document.getElementById('tab-' + t).classList.add('hidden');
                document.getElementById('nav-' + t).classList.replace('tab-active', 'text-slate-400');
            });
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.getElementById('nav-' + tab).classList.add('tab-active');
            document.getElementById('nav-' + tab).classList.remove('text-slate-400');
        }
    </script>
</body>
</html>
